const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/web-EvPCzeFV.js","assets/index-D69SCsvj.js","assets/ui-vendor-QE-oobKj.js","assets/react-vendor-ClhmtWht.js","assets/data-vendor-DLfSSb0Z.js","assets/utils-vendor-BycXaddh.js","assets/analytics-vendor-CXgENQ1a.js","assets/index-jLW3d3co.css"])))=>i.map(i=>d[i]);
import{j as e}from"./ui-vendor-QE-oobKj.js";import{a as n,R as Y,u as X,j as Q}from"./react-vendor-ClhmtWht.js";import{s as M,g as Z,B as A,C as F,b as B,c as T,d as V,e as _,r as ee,i as $,u as te,h as re,j as se,l as ne}from"./index-D69SCsvj.js";import{I as P}from"./input-8QVqFKxr.js";import{L}from"./label-DZft6xYU.js";import{J as G,n as ae,k as ie,M as O,f as q,E as oe,o as le}from"./utils-vendor-BycXaddh.js";import{_ as ce}from"./data-vendor-DLfSSb0Z.js";import{u as de}from"./use-swipe-navigation-eIglpj1B.js";import{V as ue}from"./VersionDisplay-BxpSyFxf.js";import"./analytics-vendor-CXgENQ1a.js";function me(){const[g,b]=n.useState(!1),[N,w]=n.useState("phone"),[t,o]=n.useState(""),[m,f]=n.useState(""),[v,s]=n.useState(null),h=n.useCallback(d=>{const l=d.replace(/\D/g,"");return l.length===10?`+1${l}`:l.length===11&&l.startsWith("1")?`+${l}`:`+${l}`},[]),x=n.useCallback(async()=>{if(!t.trim())return s("Please enter a phone number"),!1;b(!0),s(null);try{const d=h(t),{error:l}=await M.auth.signInWithOtp({phone:d,options:{channel:"sms"}});return l?(console.error("SMS send error:",l),s(l.message||"Failed to send verification code"),!1):(w("verification"),G.success("Verification code sent!"),!0)}catch(d){return console.error("SMS send error:",d),s(d.message||"Failed to send verification code"),!1}finally{b(!1)}},[t,h]),I=n.useCallback(async()=>{if(!m.trim()||m.length!==6)return s("Please enter a valid 6-digit verification code"),!1;b(!0),s(null);try{const d=h(t),{data:l,error:S}=await M.auth.verifyOtp({phone:d,token:m,type:"sms"});return S?(console.error("SMS verification error:",S),s(S.message||"Invalid verification code"),!1):l.user?(w("completed"),G.success("Phone number verified successfully!"),!0):(s("Verification failed. Please try again."),!1)}catch(d){return console.error("SMS verification error:",d),s(d.message||"Verification failed"),!1}finally{b(!1)}},[m,t,h]),y=n.useCallback(async()=>await x(),[x]),j=n.useCallback(()=>{w("phone"),o(""),f(""),s(null),b(!1)},[]);return{isLoading:g,step:N,phoneNumber:t,verificationCode:m,setPhoneNumber:o,setVerificationCode:f,sendSMSCode:x,verifySMSCode:I,resendCode:y,resetFlow:j,error:v}}const he=Y.memo(function({onBack:b,onSuccess:N,className:w}){const{isLoading:t,step:o,phoneNumber:m,verificationCode:f,setPhoneNumber:v,setVerificationCode:s,sendSMSCode:h,verifySMSCode:x,resendCode:I,error:y}=me(),[j,d]=n.useState(0),l=n.useRef([]);n.useEffect(()=>{if(o==="verification"){const r=c=>{const i=c.clipboardData?.getData("text");i&&/^\d{6}$/.test(i)&&(s(i),l.current[5]?.focus())};return document.addEventListener("paste",r),()=>document.removeEventListener("paste",r)}},[o,s]),n.useEffect(()=>{if(j>0){const r=setTimeout(()=>d(j-1),1e3);return()=>clearTimeout(r)}},[j]);const S=r=>{const c=r.replace(/\D/g,"");if(c.length>=10){const i=c.slice(-10);return`(${i.slice(0,3)}) ${i.slice(3,6)}-${i.slice(6)}`}return r},C=async r=>{r.preventDefault(),await h()&&d(60)},k=async r=>{r.preventDefault(),await x()&&N()},p=async()=>{if(j>0)return;await I()&&d(60)},D=(r,c)=>{const i=c.replace(/\D/g,"").slice(-1),E=f.split("");E[r]=i,s(E.join("")),i&&r<5&&l.current[r+1]?.focus()},R=(r,c)=>{c.key==="Backspace"&&!f[r]&&r>0&&l.current[r-1]?.focus()};return o==="completed"?(N(),null):e.jsxs("div",{className:Z("mx-auto w-full max-w-md",w),children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs(A,{variant:"ghost",size:"sm",onClick:b,className:"-ml-2 mb-4",children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),"Back"]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-primary/10",children:o==="phone"?e.jsx(ie,{className:"h-8 w-8 text-primary"}):e.jsx(O,{className:"h-8 w-8 text-primary"})}),e.jsx("h1",{className:"mb-2 text-2xl font-bold text-foreground",children:o==="phone"?"Sign in with SMS":"Enter verification code"}),e.jsx("p",{className:"text-muted-foreground",children:o==="phone"?"We'll send you a secure code to verify your phone number":`We sent a 6-digit code to ${S(m)}`})]})]}),o==="phone"&&e.jsxs(F,{className:"border-border",children:[e.jsxs(B,{className:"pb-4",children:[e.jsxs(T,{className:"flex items-center gap-2 text-lg",children:[e.jsx(q,{className:"h-5 w-5 text-primary"}),"Phone Number"]}),e.jsx(V,{children:"Enter your mobile phone number to receive a verification code"})]}),e.jsx(_,{children:e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"phone",children:"Phone Number"}),e.jsx(P,{id:"phone",type:"tel",placeholder:"(555) 123-4567",value:m,onChange:r=>v(r.target.value),className:"h-12 text-lg",autoComplete:"tel",autoFocus:!0})]}),y&&e.jsx("div",{className:"rounded-md border border-destructive/20 bg-destructive/10 p-3 text-sm text-destructive",children:y}),e.jsx(A,{type:"submit",className:"h-12 w-full text-base",disabled:t||!m.trim(),children:t?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-current border-r-transparent"}),"Sending code..."]}):"Send verification code"})]})})]}),o==="verification"&&e.jsxs(F,{className:"border-border",children:[e.jsxs(B,{className:"pb-4",children:[e.jsxs(T,{className:"flex items-center gap-2 text-lg",children:[e.jsx(O,{className:"h-5 w-5 text-primary"}),"Verification Code"]}),e.jsx(V,{children:"Enter the 6-digit code sent to your phone"})]}),e.jsx(_,{children:e.jsxs("form",{onSubmit:k,className:"space-y-6",children:[e.jsx("div",{className:"flex justify-center gap-2",children:Array.from({length:6},(r,c)=>e.jsx(P,{ref:i=>l.current[c]=i,type:"text",inputMode:"numeric",maxLength:1,value:f[c]||"",onChange:i=>D(c,i.target.value),onKeyDown:i=>R(c,i),className:"h-12 w-12 text-center font-mono text-lg",autoComplete:"one-time-code",autoFocus:c===0},c))}),y&&e.jsx("div",{className:"rounded-md border border-destructive/20 bg-destructive/10 p-3 text-center text-sm text-destructive",children:y}),e.jsx(A,{type:"submit",className:"h-12 w-full text-base",disabled:t||f.length!==6,children:t?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-current border-r-transparent"}),"Verifying..."]}):"Verify code"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"mb-2 text-sm text-muted-foreground",children:"Didn't receive the code?"}),e.jsx(A,{type:"button",variant:"ghost",size:"sm",onClick:p,disabled:j>0||t,className:"text-primary hover:text-primary/80",children:j>0?`Resend in ${j}s`:"Resend code"})]})]})})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx(q,{className:"mr-1 inline h-3 w-3"}),"Your phone number is encrypted and secure"]})})]})}),z=ee("SignInWithApple",{web:()=>ce(()=>import("./web-EvPCzeFV.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])).then(g=>new g.SignInWithAppleWeb)});function pe(){const[g,b]=n.useState(!1);return{signInWithApple:async()=>{if(!$())return{success:!1,error:"Apple Sign In is only available on iOS devices"};if(!M)return{success:!1,error:"Authentication service not available"};b(!0);try{console.log("Starting native Apple Sign In...");const t=await z.authorize({requestedScopes:["email","fullName"]});if(console.log("Apple Sign In response:",t),!t.response.identityToken)throw new Error("No identity token received from Apple");const o=t.response.fullName;let m="";if(o){const h=o.givenName||"",x=o.familyName||"";m=`${h} ${x}`.trim(),console.log("Extracted name from Apple Sign In:",m)}console.log("Signing in to Supabase with Apple ID token...");let f,v=0;const s=3;for(;v<s;){v++,console.log(`Supabase sign-in attempt ${v}/${s}`);try{const h=new Promise((I,y)=>setTimeout(()=>y(new Error("Request timeout")),15e3)),x=M.auth.signInWithIdToken({provider:"apple",token:t.response.identityToken,nonce:t.response.nonce,options:{skipBrowserRedirect:!0,data:m?{name:m,given_name:o?.givenName,family_name:o?.familyName}:void 0}});f=await Promise.race([x,h]);break}catch(h){if(console.log(`Attempt ${v} failed:`,h),v===s)throw h;await new Promise(x=>setTimeout(x,1e3*v))}}return f?.error?(console.error("Supabase Apple Sign In error:",f.error),{success:!1,error:`Authentication failed: ${f.error.message}`}):(console.log("Apple Sign In successful:",f.data),{success:!0})}catch(t){return console.error("Native Apple Sign In failed:",t),t.message?.includes("canceled")||t.code===1001?{success:!1,error:"Sign in was canceled"}:t.code===1e3?{success:!1,error:'Apple Sign In not configured. Please enable "Sign In with Apple" capability in Xcode and ensure your Apple Developer account has this feature enabled.'}:t.code===1004?{success:!1,error:"Apple Sign In is not supported on this device or iOS version"}:t.name==="AuthRetryableFetchError"||t.message?.includes("AuthRetryableFetchError")||t.status===0?{success:!1,error:"Network connection issue. Please check your internet connection and try again."}:t.message?.includes("timeout")||t.message?.includes("Request timeout")?{success:!1,error:"Sign in timed out. Please try again."}:{success:!1,error:t.message||`Apple Sign In failed (Error ${t.code||"Unknown"})`}}finally{b(!1)}},checkAppleSignInAvailability:async()=>{if(!$())return!1;try{const t=await z.isAvailable();return console.log("Apple Sign In availability:",t),t.isAvailable}catch(t){return console.warn("Could not check Apple Sign In availability:",t),!1}},loading:g}}const Ae=()=>{const g=X(),[b]=Q(),{user:N,loading:w,signInWithGoogle:t,signInWithApple:o,signInWithEmail:m,signUpWithEmail:f,startTrial:v}=te(),[s,h]=n.useState(b.get("mode")!=="signup"),[x,I]=n.useState(""),[y,j]=n.useState(""),[d,l]=n.useState(""),[S,C]=n.useState(!1),[k,p]=n.useState(""),[D,R]=n.useState(!1),[r,c]=n.useState(!1);de({onSwipeRight:()=>g("/"),threshold:100});const i=re(),E=se(),{signInWithApple:U,loading:W}=pe();if(n.useEffect(()=>{!w&&N&&(console.log("Authenticated user detected on login page, redirecting to dashboard"),g("/dashboard",{replace:!0})),ne()},[N,w,g]),n.useEffect(()=>{const a=u=>{u.filename&&u.filename.includes("injected.js")&&(console.warn("Browser extension error detected - this is harmless and does not affect app functionality"),u.preventDefault())};return window.addEventListener("error",a),()=>window.removeEventListener("error",a)},[]),w)return e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-linear-bg",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 h-8 w-8 animate-spin rounded-full border-2 border-linear-purple border-t-transparent"}),e.jsx("p",{className:"text-linear-text-secondary",children:"Loading..."})]})});if(N)return null;const H=async a=>{a.preventDefault(),C(!0),p(""),console.log("Starting email auth flow...");try{let u;s?(console.log("Attempting sign in..."),u=await m(x,y),console.log("Sign in result:",u)):(console.log("Attempting sign up..."),u=await f(x,y,d),console.log("Sign up result:",u)),u.error?(console.error("Auth error:",u.error),u.error.name==="UserExistsError"&&!s?(p("An account with this email already exists."),h(!0),setTimeout(()=>{p("Please sign in with your existing account.")},2e3)):u.error.name==="EmailConfirmationRequired"?p("Account created! Please check your email and click the confirmation link to complete your registration."):p(u.error.message)):(console.log("Auth successful, proceeding..."),s||(console.log("Starting trial..."),await v()),console.log("Auth successful - navigation will be handled by auth state change"))}catch(u){console.error("Unexpected error in auth flow:",u),u instanceof Error?p(u.message):p("An unexpected error occurred during authentication")}finally{console.log("Auth flow completed, setting loading to false"),C(!1)}},J=async()=>{C(!0),p("");try{console.log("Starting Google Sign In");const{error:a}=await t();a&&(console.error("Google Sign In error:",a),p(a.message||"Google Sign In failed"))}catch(a){console.error("Google Sign In error:",a),p("Google Sign In failed. Please try again.")}finally{C(!1)}},K=async()=>{C(!0),p("");try{if($()){console.log("Using native Apple Sign In on iOS");const a=await U();a.success||p(a.error||"Apple Sign In failed")}else{console.log("Using web Apple Sign In");const{error:a}=await o();a&&p(a.message)}}catch(a){console.error("Apple Sign In error:",a),p("Failed to sign in with Apple")}finally{C(!1)}};return D?e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-linear-bg p-6 font-inter",children:e.jsx(he,{onBack:()=>R(!1),onSuccess:()=>{console.log("SMS login successful, navigating to dashboard"),g("/dashboard")}})}):e.jsxs("div",{className:"flex min-h-screen flex-col bg-linear-bg font-inter",children:[e.jsx("div",{className:"flex items-center justify-between p-6",children:e.jsx(A,{variant:"ghost",onClick:()=>g("/"),className:"text-linear-text-secondary hover:text-linear-text",children:"← Back"})}),e.jsx("div",{className:"flex flex-1 flex-col items-center justify-center px-6",children:e.jsxs("div",{className:"mb-12 text-center",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-4xl font-bold tracking-tight text-linear-text",children:"LogYourBody"}),e.jsx("p",{className:"mt-3 text-lg text-linear-text-secondary",children:"Track real progress. Not just weight."})]}),e.jsxs("div",{className:"mx-auto w-full max-w-sm space-y-4",children:[k&&e.jsx("div",{className:`rounded-lg p-3 text-center text-sm ${k.includes("Account created!")||k.includes("Please sign in with your existing account")?"border border-linear-purple/30 bg-linear-purple/10 text-linear-purple":"border border-red-500/30 bg-red-500/10 text-red-500"}`,children:k}),i&&e.jsxs("form",{onSubmit:H,className:"space-y-4",children:[!s&&e.jsxs("div",{children:[e.jsx(L,{htmlFor:"name",className:"sr-only",children:"Name"}),e.jsx(P,{id:"name",type:"text",placeholder:"Full name",value:d,onChange:a=>l(a.target.value),required:!0,className:"h-12 border border-linear-border bg-linear-card text-base text-linear-text placeholder:text-linear-text-tertiary rounded-lg transition-all focus:border-linear-purple focus:outline-none focus:ring-2 focus:ring-linear-purple/20"})]}),e.jsxs("div",{children:[e.jsx(L,{htmlFor:"email",className:"sr-only",children:"Email"}),e.jsx(P,{id:"email",type:"email",placeholder:"Email address",value:x,onChange:a=>I(a.target.value),required:!0,className:"h-12 border border-linear-border bg-linear-card text-base text-linear-text placeholder:text-linear-text-tertiary rounded-lg transition-all focus:border-linear-purple focus:outline-none focus:ring-2 focus:ring-linear-purple/20"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(L,{htmlFor:"password",className:"sr-only",children:"Password"}),e.jsx(P,{id:"password",type:r?"text":"password",placeholder:"Password",value:y,onChange:a=>j(a.target.value),required:!0,className:"h-12 border border-linear-border bg-linear-card pr-12 text-base text-linear-text placeholder:text-linear-text-tertiary rounded-lg transition-all focus:border-linear-purple focus:outline-none focus:ring-2 focus:ring-linear-purple/20"}),e.jsx("button",{type:"button",onClick:()=>c(!r),className:"absolute right-3 top-1/2 hidden -translate-y-1/2 text-linear-text-tertiary transition-colors hover:text-linear-text md:block",tabIndex:-1,"aria-label":r?"Hide password":"Show password",children:r?e.jsx(oe,{className:"h-5 w-5"}):e.jsx(le,{className:"h-5 w-5"})})]}),e.jsx(A,{type:"submit",disabled:S,className:"h-12 w-full bg-linear-text text-base font-medium text-linear-bg hover:bg-linear-text/90 rounded-lg transition-colors",children:S?"Please wait...":s?"Sign In":"Create Account"})]}),(i||E)&&e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("span",{className:"w-full border-t border-linear-border"})}),e.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:e.jsx("span",{className:"bg-linear-bg px-2 text-linear-text-tertiary",children:"Or continue with"})})]}),e.jsxs("div",{className:"space-y-3",children:[!1,E&&e.jsxs(A,{type:"button",variant:"outline",onClick:J,disabled:S,className:"h-12 w-full border-linear-border bg-linear-card font-medium text-linear-text hover:bg-linear-border/50 rounded-lg transition-colors",children:[e.jsxs("svg",{className:"mr-3 h-5 w-5",fill:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z",fill:"#4285F4"}),e.jsx("path",{d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z",fill:"#34A853"}),e.jsx("path",{d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z",fill:"#FBBC05"}),e.jsx("path",{d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z",fill:"#EA4335"})]}),S?"Signing in...":"Continue with Google"]}),e.jsxs(A,{type:"button",variant:"outline",onClick:K,disabled:S||W,className:"h-12 w-full border-linear-border bg-linear-card font-medium text-linear-text hover:bg-linear-border/50 rounded-lg transition-colors",children:[e.jsx("svg",{className:"mr-3 h-5 w-5",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12.152 6.896c-.948 0-2.415-1.078-3.96-1.04-2.04.027-3.91 1.183-4.961 3.014-2.117 3.675-.546 9.103 1.519 12.09 1.013 1.454 2.208 3.09 3.792 3.039 1.52-.065 2.09-.987 3.935-.987 1.831 0 2.35.987 3.96.948 1.637-.026 2.676-1.48 3.676-2.948 1.156-1.688 1.636-3.325 1.662-3.415-.039-.013-3.182-1.221-3.22-4.857-.026-3.04 2.48-4.494 2.597-4.559-1.429-2.09-3.623-2.324-4.39-2.376-2-.156-3.675 1.09-4.61 1.09zM15.53 3.83c.843-1.012 1.4-2.427 1.245-3.83-1.207.052-2.662.805-3.532 1.818-.78.896-1.454 2.338-1.273 3.714 1.338.104 2.715-.688 3.559-1.701"})}),S||W?"Signing in...":"Continue with Apple"]})]}),i&&e.jsx("div",{className:"text-center",children:e.jsx(A,{type:"button",variant:"ghost",onClick:()=>h(!s),className:"text-sm text-linear-text-secondary hover:text-linear-text transition-colors",children:s?"Don't have an account? Sign up":"Already have an account? Sign in"})})]})]})}),e.jsxs("div",{className:"p-6 text-center",children:[e.jsxs("p",{className:"text-sm text-linear-text-tertiary",children:["By continuing, you agree to our"," ",e.jsx("button",{onClick:()=>g("/terms"),className:"text-linear-purple hover:underline",children:"Terms of Service"})," ","and"," ",e.jsx("button",{onClick:()=>g("/privacy"),className:"text-linear-purple hover:underline",children:"Privacy Policy"})]}),e.jsx("div",{className:"mt-4 flex justify-center gap-4",children:e.jsx("button",{onClick:()=>g("/changelog"),className:"text-sm text-linear-text-tertiary transition-colors hover:text-linear-text",children:"Changelog"})}),e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsx(ue,{})})]})]})};export{Ae as default};
