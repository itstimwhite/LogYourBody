import{v as ye,j as e,w as ne,x as ce,y as oe}from"./ui-vendor-QE-oobKj.js";import{a as l,u as Ne}from"./react-vendor-ClhmtWht.js";import{g as P,u as V,B as C,a as I,n as we,t as A,k as Se,i as Ce,s as Y,o as Ee}from"./index-C6tVOIHe.js";import{S as $}from"./switch-BZ6u6mig.js";import{I as q}from"./input-C37gzPpr.js";import{L as B}from"./label-DevTPJCg.js";import{D as R,a as _,b as M,c as F,d as Te,u as ke}from"./use-supabase-body-metrics-Q034gvlj.js";import{F as X,P as Z,v as De,f as ee,k as se,h as U,w as H,x as te,y as ae,L as W,z as Ae,B as Ie,D as Pe,o as re,E as K,G as Re}from"./utils-vendor-BSj6XY88.js";import{V as _e}from"./VersionDisplay-C6c0XCyL.js";import{u as Me,g as Fe,h as Oe,R as Be}from"./RevenueCatPaywall-BIJEpRxf.js";import{H as Ke}from"./HealthKitDebug-CtOSojRy.js";import{u as Le}from"./data-vendor-DLfSSb0Z.js";import{u as Ue}from"./use-swipe-navigation-eIglpj1B.js";import"./analytics-vendor-CXgENQ1a.js";const ie=ye,z=l.forwardRef(({className:s,...u},t)=>e.jsx(ne,{ref:t,className:P("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...u}));z.displayName=ne.displayName;const L=l.forwardRef(({className:s,...u},t)=>e.jsx(ce,{ref:t,className:P("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",s),...u}));L.displayName=ce.displayName;const Ye=l.forwardRef(({className:s,...u},t)=>e.jsx(oe,{ref:t,className:P("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...u}));Ye.displayName=oe.displayName;const O=({items:s,selectedIndex:u,onSelectionChange:t,className:m,itemHeight:o=48,visibleItems:x=5})=>{const d=l.useRef(null),[h,p]=l.useState(!1),[b,v]=l.useState(0),[c,a]=l.useState(0),n=o*x;s.length*o;const f=Math.floor(x/2)*o;l.useEffect(()=>{if(d.current){const y=u*o;d.current.scrollTop=y}},[u,o]);const r=()=>{if(!d.current||h)return;const y=d.current.scrollTop,w=Math.round(y/o),k=Math.max(0,Math.min(s.length-1,w));k!==u&&t(k)},j=y=>{p(!0),v(y.clientY),a(d.current?.scrollTop||0)},E=y=>{if(!h||!d.current)return;const w=y.clientY-b,k=c-w;d.current.scrollTop=k},i=()=>{p(!1),D()},g=y=>{p(!0),v(y.touches[0].clientY),a(d.current?.scrollTop||0)},N=y=>{if(!h||!d.current)return;const w=y.touches[0].clientY-b,k=c-w;d.current.scrollTop=k},T=()=>{p(!1),D()},D=()=>{if(!d.current)return;const y=d.current.scrollTop,w=Math.round(y/o),k=Math.max(0,Math.min(s.length-1,w));d.current.scrollTo({top:k*o,behavior:"smooth"}),t(k)};return e.jsxs("div",{className:P("relative select-none",m),children:[e.jsx("div",{className:"pointer-events-none absolute left-0 right-0 z-10 border-y border-primary/20 bg-primary/10",style:{top:f,height:o}}),e.jsxs("div",{ref:d,className:"scrollbar-hide overflow-hidden",style:{height:n},onScroll:r,onMouseDown:j,onMouseMove:E,onMouseUp:i,onMouseLeave:i,onTouchStart:g,onTouchMove:N,onTouchEnd:T,children:[Array(Math.floor(x/2)).fill(null).map((y,w)=>e.jsx("div",{style:{height:o}},`padding-start-${w}`)),s.map((y,w)=>e.jsx("div",{className:P("flex cursor-pointer items-center justify-center text-center transition-opacity duration-200",w===u?"font-medium text-foreground":"text-muted-foreground"),style:{height:o},onClick:()=>t(w),children:y},w)),Array(Math.floor(x/2)).fill(null).map((y,w)=>e.jsx("div",{style:{height:o}},`padding-end-${w}`))]})]})},$e=({heightInCm:s,units:u,onHeightChange:t,className:m})=>{if(u==="imperial"){const o=Math.round(s/2.54),x=Math.floor(o/12),d=o%12,h=Array.from({length:6},(c,a)=>a+3),p=Array.from({length:12},(c,a)=>a),b=c=>{const n=h[c]*12+d;t(n*2.54)},v=c=>{const a=p[c],n=x*12+a;t(n*2.54)};return e.jsxs("div",{className:P("flex gap-4",m),children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"mb-2 text-center text-sm font-medium",children:"Feet"}),e.jsx(O,{items:h.map(c=>`${c} ft`),selectedIndex:x-3,onSelectionChange:b,className:"rounded-lg bg-secondary"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"mb-2 text-center text-sm font-medium",children:"Inches"}),e.jsx(O,{items:p.map(c=>`${c} in`),selectedIndex:d,onSelectionChange:v,className:"rounded-lg bg-secondary"})]})]})}else{const o=Array.from({length:151},(h,p)=>p+100),x=Math.max(0,s-100),d=h=>{t(o[h])};return e.jsxs("div",{className:m,children:[e.jsx("div",{className:"mb-2 text-center text-sm font-medium",children:"Centimeters"}),e.jsx(O,{items:o.map(h=>`${h} cm`),selectedIndex:x,onSelectionChange:d,className:"rounded-lg bg-secondary"})]})}},qe=({date:s,onDateChange:u,className:t})=>{const m=new Date().getFullYear(),o=["January","February","March","April","May","June","July","August","September","October","November","December"],x=Array.from({length:m-1919},(r,j)=>m-j),d=(r,j)=>new Date(j,r+1,0).getDate(),h=s.getMonth(),p=s.getFullYear(),b=s.getDate(),v=d(h,p),c=Array.from({length:v},(r,j)=>j+1),a=r=>{const j=new Date(p,r,Math.min(b,d(r,p)));u(j)},n=r=>{const j=new Date(p,h,c[r]);u(j)},f=r=>{const j=x[r],E=new Date(j,h,Math.min(b,d(h,j)));u(E)};return e.jsxs("div",{className:P("flex gap-2",t),children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"mb-2 text-center text-sm font-medium",children:"Month"}),e.jsx(O,{items:o,selectedIndex:h,onSelectionChange:a,className:"rounded-lg bg-secondary"})]}),e.jsxs("div",{className:"w-16",children:[e.jsx("div",{className:"mb-2 text-center text-sm font-medium",children:"Day"}),e.jsx(O,{items:c,selectedIndex:b-1,onSelectionChange:n,className:"rounded-lg bg-secondary"})]}),e.jsxs("div",{className:"w-20",children:[e.jsx("div",{className:"mb-2 text-center text-sm font-medium",children:"Year"}),e.jsx(O,{items:x,selectedIndex:x.indexOf(p),onSelectionChange:f,className:"rounded-lg bg-secondary"})]})]})};function He(){const{user:s}=V(),[u,t]=l.useState({isSupported:!1,isAvailable:!1,isRegistered:!1,credentials:[],loading:!0,error:null});l.useEffect(()=>{m()},[]),l.useEffect(()=>{s&&o()},[s]);const m=async()=>{if(!(window.PublicKeyCredential!==void 0)){t(n=>({...n,isSupported:!1,isAvailable:!1,loading:!1}));return}try{const n=await PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable();t(f=>({...f,isSupported:!0,isAvailable:n,loading:!1}))}catch(n){console.error("Error checking WebAuthn availability:",n),t(f=>({...f,isSupported:!0,isAvailable:!1,loading:!1,error:"Failed to check biometric availability"}))}},o=async()=>{if(s)try{const a=localStorage.getItem(`webauthn_credentials_${s.id}`),n=a?JSON.parse(a):[];t(f=>({...f,credentials:n,isRegistered:n.length>0}))}catch(a){console.error("Error loading credentials:",a),t(n=>({...n,error:"Failed to load biometric credentials"}))}},x=()=>crypto.getRandomValues(new Uint8Array(32)),d=a=>{const n=new Uint8Array(a);let f="";for(const r of n)f+=String.fromCharCode(r);return btoa(f).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")},h=async()=>{if(!u.isSupported||!u.isAvailable||!s)return t(a=>({...a,error:"Biometric authentication not available"})),!1;t(a=>({...a,loading:!0,error:null}));try{const a=x(),n=new TextEncoder().encode(s.id),f={challenge:a,rp:{name:"LogYourBody",id:window.location.hostname},user:{id:n,name:s.email||"",displayName:s.user_metadata?.name||s.email||"User"},pubKeyCredParams:[{alg:-7,type:"public-key"},{alg:-257,type:"public-key"}],authenticatorSelection:{authenticatorAttachment:"platform",userVerification:"required",requireResidentKey:!1},timeout:6e4,attestation:"direct"},r=await navigator.credentials.create({publicKey:f});if(!r)throw new Error("Failed to create credential");const j=r.response,E={id:r.id,publicKey:d(j.getPublicKey()),counter:0,deviceType:c(),createdAt:new Date().toISOString()},i=[...u.credentials,E];return localStorage.setItem(`webauthn_credentials_${s.id}`,JSON.stringify(i)),t(g=>({...g,credentials:i,isRegistered:!0,loading:!1})),!0}catch(a){console.error("Biometric registration failed:",a);let n="Failed to register biometric authentication";return a.name==="NotAllowedError"?n="Biometric registration was cancelled or denied":a.name==="NotSupportedError"&&(n="Biometric authentication is not supported on this device"),t(f=>({...f,loading:!1,error:n})),!1}},p=async()=>{if(!u.isSupported||!u.isAvailable||!u.isRegistered||!s)return t(a=>({...a,error:"Biometric authentication not available"})),!1;t(a=>({...a,loading:!0,error:null}));try{const a=x(),n=u.credentials.map(i=>({id:new TextEncoder().encode(i.id),type:"public-key"})),f={challenge:a,allowCredentials:n,timeout:6e4,userVerification:"required"},r=await navigator.credentials.get({publicKey:f});if(!r)throw new Error("Failed to get assertion");const j=d(r.rawId);if(!u.credentials.find(i=>i.id===r.id||i.id===j))throw new Error("Credential not found");return console.log("Biometric authentication successful:",r),t(i=>({...i,loading:!1})),!0}catch(a){console.error("Biometric authentication failed:",a);let n="Biometric authentication failed";return a.name==="NotAllowedError"?n="Biometric authentication was cancelled or denied":a.name==="InvalidStateError"?n="No registered biometric credentials found":a.message==="Credential not found"&&(n="Invalid biometric credential"),t(f=>({...f,loading:!1,error:n})),!1}},b=async a=>{try{const n=u.credentials.filter(f=>f.id!==a);return s&&localStorage.setItem(`webauthn_credentials_${s.id}`,JSON.stringify(n)),t(f=>({...f,credentials:n,isRegistered:n.length>0})),!0}catch(n){return console.error("Failed to remove biometric credential:",n),t(f=>({...f,error:"Failed to remove biometric credential"})),!1}},v=async()=>{if(!u.isSupported)return!1;try{return await PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable()}catch{return!1}},c=()=>{const a=navigator.userAgent;return/iPhone|iPad|iPod/.test(a)?"iOS":/Android/.test(a)?"Android":/Mac/.test(a)?"macOS":/Windows/.test(a)?"Windows":"Unknown"};return{...u,registerBiometric:h,authenticateWithBiometric:p,removeBiometric:b,checkBiometricAvailability:v}}function We({onComplete:s}){const{isSupported:u,isAvailable:t,isRegistered:m,credentials:o,loading:x,error:d,registerBiometric:h,removeBiometric:p}=He(),[b,v]=l.useState(!1),c=async()=>{v(!0);const r=await h();v(!1),r&&s&&s()},a=async r=>{await p(r)},n=r=>{switch(r){case"iOS":return e.jsx(se,{className:"h-4 w-4"});case"Android":return e.jsx(se,{className:"h-4 w-4"});case"macOS":return e.jsx(X,{className:"h-4 w-4"});default:return e.jsx(ee,{className:"h-4 w-4"})}},f=r=>{switch(r){case"iOS":return"Face ID / Touch ID";case"Android":return"Fingerprint / Face Unlock";case"macOS":return"Touch ID";case"Windows":return"Windows Hello";default:return"Biometric"}};return u?t?e.jsxs("div",{className:"space-y-4",children:[d&&e.jsx("div",{className:"rounded-md bg-destructive/10 p-3 text-sm text-destructive",children:d}),m?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Registered devices"}),e.jsxs(I,{variant:"secondary",className:"text-xs",children:[o.length," device",o.length!==1?"s":""]})]}),e.jsx("div",{className:"space-y-2",children:o.map(r=>e.jsxs("div",{className:"flex items-center justify-between rounded-md bg-secondary p-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[n(r.deviceType),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:f(r.deviceType)}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Added"," ",new Date(r.createdAt).toLocaleDateString()]})]})]}),e.jsx(C,{variant:"ghost",size:"sm",onClick:()=>a(r.id),className:"text-destructive hover:text-destructive",children:e.jsx(De,{className:"h-4 w-4"})})]},r.id))}),e.jsx(C,{onClick:c,disabled:b||x,variant:"outline",className:"w-full",children:b?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mr-2 h-4 w-4 animate-spin rounded-full border-2 border-current border-r-transparent"}),"Adding device..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"mr-2 h-4 w-4"}),"Add another device"]})})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-muted-foreground",children:[e.jsx(X,{className:"h-4 w-4"}),e.jsx("span",{children:"No biometric credentials registered"})]}),e.jsx(C,{onClick:c,disabled:b||x,className:"w-full",children:b?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mr-2 h-4 w-4 animate-spin rounded-full border-2 border-current border-r-transparent"}),"Setting up biometric authentication..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"mr-2 h-4 w-4"}),"Set up biometric authentication"]})})]}),e.jsx("div",{className:"rounded-md bg-muted p-3 text-xs text-muted-foreground",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(ee,{className:"mt-0.5 h-3 w-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"mb-1 font-medium",children:"How it works:"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsx("li",{children:"• Your biometric data never leaves your device"}),e.jsx("li",{children:"• Only a secure credential is stored with LogYourBody"}),e.jsx("li",{children:"• You can remove access anytime from your settings"})]})]})]})})]}):e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"text-sm text-muted-foreground",children:"Biometric authentication is not available on this device. Make sure you have Touch ID, Face ID, or fingerprint authentication enabled in your device settings."})}):e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"text-sm text-muted-foreground",children:"Your device doesn't support biometric authentication."})})}function ze(){const[s,u]=l.useState(null),[t,m]=l.useState(!1);l.useEffect(()=>{o()},[]);const o=async()=>{m(!0);try{const h=await we();u(h)}catch(h){console.error("Error checking database status:",h)}finally{m(!1)}},x=h=>h?e.jsx(H,{className:"h-4 w-4 text-green-500"}):e.jsx(te,{className:"h-4 w-4 text-red-500"}),d=h=>e.jsx(I,{variant:h?"default":"destructive",children:h?"Exists":"Missing"});return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Check if all required database tables exist and are accessible"}),e.jsx(C,{variant:"outline",size:"sm",onClick:o,disabled:t,children:t?e.jsx(U,{className:"h-4 w-4 animate-spin"}):e.jsx(U,{className:"h-4 w-4"})})]}),s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[s.connected?e.jsx(H,{className:"h-4 w-4 text-green-500"}):e.jsx(te,{className:"h-4 w-4 text-red-500"}),"Database Connection"]}),e.jsx(I,{variant:s.connected?"default":"destructive",children:s.connected?"Connected":"Disconnected"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium",children:"Tables:"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[x(s.profilesTableExists),"profiles"]}),d(s.profilesTableExists)]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[x(s.userSettingsTableExists),"user_settings"]}),d(s.userSettingsTableExists)]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[x(s.emailSubscriptionsTableExists),"email_subscriptions"]}),d(s.emailSubscriptionsTableExists)]})]}),s.error&&e.jsx("div",{className:"rounded-md border border-destructive/20 bg-destructive/10 p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ae,{className:"mt-0.5 h-4 w-4 text-destructive"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-destructive",children:"Error"}),e.jsx("p",{className:"text-xs text-destructive/80",children:s.error})]})]})}),!s.profilesTableExists&&e.jsx("div",{className:"rounded-md border border-yellow-200 bg-yellow-50 p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ae,{className:"mt-0.5 h-4 w-4 text-yellow-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-yellow-800",children:"Migration Required"}),e.jsx("p",{className:"text-xs text-yellow-700",children:"Run database migrations to create the required tables."})]})]})})]}):e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx(U,{className:"mx-auto mb-2 h-8 w-8 animate-spin text-muted-foreground"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Checking database status..."})]})})]})}function Ve(){const{isConfigured:s,isLoading:u,customerInfo:t,offerings:m,error:o,getOfferings:x,restorePurchases:d}=Me(),[h,p]=l.useState(!1),[b,v]=l.useState(!1),c=async()=>{p(!0);try{const r=await x();A({title:"Offerings Test",description:`Found ${r.length} offerings`}),console.log("Offerings:",r)}catch(r){A({title:"Offerings Test Failed",description:r instanceof Error?r.message:"Unknown error",variant:"destructive"})}finally{p(!1)}},a=async()=>{p(!0);try{const r=await d();A({title:"Restore Test",description:"Purchase restoration completed"}),console.log("Restored Customer Info:",r)}catch(r){A({title:"Restore Test Failed",description:r instanceof Error?r.message:"Unknown error",variant:"destructive"})}finally{p(!1)}},n=Fe(t),f=Oe(t);return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Debug and test RevenueCat subscription functionality"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Configuration:"}),e.jsx(I,{variant:s?"default":"destructive",children:s?"Configured":"Not Configured"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Loading:"}),e.jsx(I,{variant:u?"secondary":"outline",children:u?"Loading":"Ready"})]})]}),o&&e.jsxs("div",{className:"rounded-lg border border-destructive/20 bg-destructive/10 p-3",children:[e.jsx("p",{className:"text-sm font-medium text-destructive",children:"Error:"}),e.jsx("p",{className:"text-sm text-destructive",children:o})]}),t&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-semibold",children:"Customer Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"User ID:"}),e.jsx("p",{className:"break-all text-muted-foreground",children:t.originalAppUserId})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Pro Features:"}),e.jsx(I,{variant:f?"default":"outline",children:f?"Active":"Inactive"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Subscription:"}),e.jsx(I,{variant:n.isActive?"default":"outline",children:n.isActive?"Active":"Inactive"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Will Renew:"}),e.jsx(I,{variant:n.willRenew?"default":"secondary",children:n.willRenew?"Yes":"No"})]})]}),n.expirationDate&&e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Expires:"}),e.jsx("p",{className:"text-muted-foreground",children:new Date(n.expirationDate).toLocaleDateString()})]})]}),m&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-semibold",children:"Available Offerings"}),e.jsx("div",{className:"space-y-2",children:m.map((r,j)=>e.jsxs("div",{className:"rounded-lg bg-muted/50 p-3",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("span",{className:"font-medium",children:r.metadata?.displayName||r.identifier}),e.jsxs(I,{variant:"outline",children:[r.availablePackages.length," packages"]})]}),e.jsx("div",{className:"space-y-1 text-sm text-muted-foreground",children:r.availablePackages.map((E,i)=>e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:E.identifier}),e.jsxs("span",{children:["$",E.product.price]})]},i))})]},j))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-semibold",children:"Test Actions"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(C,{onClick:c,disabled:h||!s,variant:"outline",size:"sm",children:[h?e.jsx(W,{className:"mr-1 h-4 w-4 animate-spin"}):e.jsx(U,{className:"mr-1 h-4 w-4"}),"Test Offerings"]}),e.jsxs(C,{onClick:a,disabled:h||!s,variant:"outline",size:"sm",children:[h?e.jsx(W,{className:"mr-1 h-4 w-4 animate-spin"}):e.jsx(U,{className:"mr-1 h-4 w-4"}),"Restore Purchases"]}),e.jsxs(C,{onClick:()=>v(!0),disabled:!s,variant:"default",size:"sm",children:[e.jsx(Ae,{className:"mr-1 h-4 w-4"}),"Test Paywall"]})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"mb-2 text-sm font-semibold",children:"Environment"}),e.jsxs("div",{className:"space-y-1 text-xs text-muted-foreground",children:[e.jsxs("div",{children:["Public Key:"," ","appl_dJsnXzyTgEAsntJQjOxeOvOnoXP".startsWith("sk_")?"✗ Secret key (should be public)":"✓ Configured"]}),e.jsxs("div",{children:["Platform: ",navigator.platform]}),e.jsxs("div",{children:["User Agent: ",navigator.userAgent.substring(0,50),"..."]})]})]}),e.jsx(R,{open:b,onOpenChange:v,children:e.jsxs(_,{className:"max-w-lg",children:[e.jsx(M,{children:e.jsx(F,{children:"RevenueCat Paywall Test"})}),e.jsx(Be,{onSuccess:()=>{A({title:"Purchase Success!",description:"RevenueCat integration test completed successfully"}),v(!1)},onError:r=>{A({title:"Purchase Test Failed",description:r,variant:"destructive"})}})]})})]})}function Je(){const{isAvailable:s,isAuthorized:u,syncToDatabase:t,loading:m}=Se(),[o,x]=l.useState(!1),[d,h]=l.useState(null),p=async()=>{if(!Ce()){A({title:"Not Available",description:"HealthKit sync is only available on iOS devices",variant:"destructive"});return}if(!s||!u){A({title:"HealthKit Not Available",description:"Please enable HealthKit permissions in settings",variant:"destructive"});return}x(!0);try{console.log("Starting HealthKit sync...");const c=await t();if(h(c),c.success){const a=[];c.weightEntries&&a.push(`${c.weightEntries} weight entries`),c.bodyFatEntries&&a.push(`${c.bodyFatEntries} body fat entries`),c.stepEntries&&a.push(`${c.stepEntries} days of step data`),c.profileUpdated&&a.push("profile updated"),A({title:"HealthKit Sync Complete",description:a.length>0?`Synced: ${a.join(", ")}`:"All data up to date"})}else A({title:"Sync Failed",description:c.error||"Unknown error occurred",variant:"destructive"})}catch(c){console.error("Sync error:",c),A({title:"Sync Failed",description:c instanceof Error?c.message:"Unknown error occurred",variant:"destructive"})}finally{x(!1)}},b=()=>o||m?e.jsx(W,{className:"mr-2 h-4 w-4 animate-spin"}):d?.success?e.jsx(H,{className:"mr-2 h-4 w-4 text-green-500"}):d?.success===!1?e.jsx(Ie,{className:"mr-2 h-4 w-4 text-red-500"}):e.jsx(Pe,{className:"mr-2 h-4 w-4"}),v=()=>o?"Syncing...":m?"Loading...":"Sync now";return e.jsxs(C,{variant:"outline",size:"sm",onClick:p,disabled:o||m||!s||!u,className:"w-full border-border bg-secondary text-foreground hover:bg-muted",children:[b(),v()]})}function Ge(){const{user:s}=V();Le();const[u,t]=l.useState(!1),[m,o]=l.useState({status:"trial",isTrialActive:!1,daysRemainingInTrial:0}),[x,d]=l.useState(null),h=async()=>{if(!s?.id)return null;const{data:i,error:g}=await Y.from("subscriptions").select("*").eq("user_id",s.id).single();if(g&&g.code!=="PGRST116")throw new Error(`Failed to fetch subscription: ${g.message}`);return i},b=Te({queryKey:["subscription",s?.id],queryFn:h,enabled:!!s?.id}).isLoading,v=l.useCallback(i=>{if(!i)return{isTrialActive:!1,daysRemainingInTrial:0};const g=new Date,N=g<i,T=Math.max(0,Math.ceil((i.getTime()-g.getTime())/(1e3*60*60*24)));return{isTrialActive:N,daysRemainingInTrial:T}},[]),c=l.useCallback(async()=>{if(s){t(!0);try{const i=new Date,g=new Date(i.getTime()+3*24*60*60*1e3),{error:N}=await Y.from("subscriptions").upsert({user_id:s.id,status:"trial",trial_start_date:i.toISOString(),trial_end_date:g.toISOString()});if(N){console.error("Error starting trial:",N);return}o({status:"trial",trialStartDate:i,trialEndDate:g,isTrialActive:!0,daysRemainingInTrial:3})}catch(i){console.error("Failed to start trial:",i)}finally{t(!1)}}},[s]),a=l.useCallback(async()=>{if(s){t(!0);try{const{data:i}=await Y.from("subscriptions").select("*").eq("user_id",s.id).single();if(i){const g=i.trial_start_date?new Date(i.trial_start_date):void 0,N=i.trial_end_date?new Date(i.trial_end_date):void 0,T=i.subscription_start_date?new Date(i.subscription_start_date):void 0,D=i.subscription_end_date?new Date(i.subscription_end_date):void 0,{isTrialActive:y,daysRemainingInTrial:w}=v(N);o({status:i.status,trialStartDate:g,trialEndDate:N,subscriptionStartDate:T,subscriptionEndDate:D,productId:i.product_id,isTrialActive:y,daysRemainingInTrial:w}),i.status==="active"&&D&&d({nextBillingDate:D,lastPaymentDate:T,paymentMethod:"Apple Pay",amount:i.product_id?.includes("yearly")?79.99:9.99,currency:"USD"})}else console.log("No subscription found, starting trial for new user"),await c()}catch(i){console.error("Error loading subscription data:",i)}finally{t(!1)}}},[s,v,c]),n=l.useMemo(()=>m.status==="active"||m.isTrialActive,[m.status,m.isTrialActive]),f=l.useMemo(()=>m.status==="trial"&&!m.isTrialActive,[m.status,m.isTrialActive]),r=l.useCallback(async i=>{if(!s)return{success:!1,error:new Error("User not authenticated")};t(!0);try{console.log("Purchasing subscription:",i),await new Promise(D=>setTimeout(D,2e3));const g=new Date,N=new Date(g.getTime()+30*24*60*60*1e3),{error:T}=await Y.from("subscriptions").upsert({user_id:s.id,status:"active",subscription_start_date:g.toISOString(),subscription_end_date:N.toISOString(),product_id:i});return T?(console.error("Error updating subscription:",T),{success:!1,error:T}):(o({status:"active",subscriptionStartDate:g,subscriptionEndDate:N,productId:i,isTrialActive:!1,daysRemainingInTrial:0}),d({nextBillingDate:N,lastPaymentDate:g,paymentMethod:"Apple Pay",amount:i.includes("yearly")?79.99:9.99,currency:"USD"}),{success:!0})}catch(g){return console.error("Purchase failed:",g),{success:!1,error:g}}finally{t(!1)}},[s]),j=l.useCallback(async()=>{t(!0);try{return console.log("Restoring purchases..."),await new Promise(i=>setTimeout(i,1e3)),await a(),{success:!0}}catch(i){return console.error("Restore failed:",i),{success:!1,error:i}}finally{t(!1)}},[]),E=l.useCallback(async()=>{const g=/iPad|iPhone|iPod/.test(navigator.userAgent)?"https://apps.apple.com/account/subscriptions":"https://play.google.com/store/account/subscriptions";window.open(g,"_blank")},[]);return l.useEffect(()=>{s&&a()},[s,a]),l.useEffect(()=>{if(!m.trialEndDate)return;const i=setInterval(()=>{const{isTrialActive:g,daysRemainingInTrial:N}=v(m.trialEndDate);o(T=>({...T,isTrialActive:g,daysRemainingInTrial:N}))},6e4);return()=>clearInterval(i)},[m.trialEndDate,v]),{subscriptionInfo:m,billingInfo:x,isLoading:u,loading:b,hasAccess:n,isTrialExpired:f,startTrial:c,purchaseSubscription:r,restorePurchases:j,cancelSubscription:E}}const us=()=>{const s=Ne(),{signOut:u}=V(),{user:t,settings:m,updateSettings:o,updateUser:x,getFormattedHeight:d,loading:h}=ke();Ge();const[p,b]=l.useState(!1),[v,c]=l.useState(!1),[a,n]=l.useState(!1),[f,r]=l.useState(!1),[j,E]=l.useState(!1),[i,g]=l.useState(t?.name||""),[N,T]=l.useState(t?.birthday?t.birthday:new Date(2e3,0,1)),[D,y]=l.useState(t?.height||175),[w,k]=l.useState(t?.email||""),[le,J]=l.useState(""),[de,G]=l.useState(!1);l.useEffect(()=>{t&&(g(t.name||""),T(t.birthday?t.birthday:new Date(2e3,0,1)),y(t.height||175),k(t.email||""))},[t]);const ue=S=>{console.log("Gender changing to:",S),x({gender:S})},me=S=>{o({healthKitSyncEnabled:S})},he=S=>{o({googleFitSyncEnabled:S})},xe=async S=>{if(S)try{await Notification.requestPermission()==="granted"?(G(!0),console.log("Notifications enabled")):console.log("Notifications denied")}catch(Q){console.error("Error requesting notification permission:",Q)}else G(!1)},fe=()=>{x({name:i}),b(!1)},ge=()=>{x({birthday:N instanceof Date?N:new Date(N)}),c(!1)},pe=()=>{x({height:Math.round(D)}),n(!1)},be=()=>{x({email:w}),r(!1)},ve=()=>{console.log("Password updated"),J(""),E(!1)},je=async()=>{try{await u(),s("/")}catch(S){console.error("Error signing out:",S)}};return Ue({onSwipeRight:()=>s("/dashboard"),threshold:100}),h?e.jsx("div",{className:"min-h-screen bg-background text-foreground",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-16 border-b border-border bg-secondary/20"}),e.jsx("div",{className:"space-y-8 p-6",children:[1,2,3].map(S=>e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-4 w-24 rounded bg-secondary/30"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-12 rounded bg-secondary/20"}),e.jsx("div",{className:"h-12 rounded bg-secondary/20"}),e.jsx("div",{className:"h-12 rounded bg-secondary/20"})]})]},S))})]})}):!t||!m?e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-background",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-muted-foreground",children:"Failed to load settings. Please try again."}),e.jsx(C,{onClick:()=>window.location.reload(),className:"mt-4",variant:"outline",children:"Retry"})]})}):e.jsx(Ee,{children:e.jsxs("div",{className:"flex h-screen flex-col overflow-hidden bg-background text-foreground",children:[e.jsxs("div",{className:"flex flex-shrink-0 items-center gap-4 border-b border-border px-6 pb-4 pt-safe-top",children:[e.jsx(C,{size:"icon",variant:"outline",onClick:()=>s("/dashboard"),className:"h-10 w-10 border-border bg-secondary text-foreground hover:bg-muted",children:e.jsx(re,{className:"h-4 w-4"})}),e.jsx("h1",{className:"text-lg font-semibold tracking-tight",children:"Settings"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto space-y-8 p-6 pb-safe-bottom",children:[e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"-mx-2 flex cursor-pointer items-center justify-between rounded border-b border-border px-2 py-3 hover:bg-secondary/20",onClick:()=>b(!0),children:[e.jsx("div",{className:"text-base font-medium text-foreground",children:"Name"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-muted-foreground",children:t?.name||"Not set"}),e.jsx(K,{className:"h-4 w-4 text-muted-foreground"})]})]}),e.jsxs("div",{className:"-mx-2 flex cursor-pointer items-center justify-between rounded border-b border-border px-2 py-3 hover:bg-secondary/20",onClick:()=>c(!0),children:[e.jsx("div",{className:"text-base font-medium text-foreground",children:"Birthday"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-muted-foreground",children:t?.birthday?t.birthday.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"Not set"}),e.jsx(K,{className:"h-4 w-4 text-muted-foreground"})]})]}),e.jsxs("div",{className:"border-b border-border py-3",children:[e.jsx("div",{className:"mb-3 flex items-center justify-between",children:e.jsx("div",{className:"text-base font-medium text-foreground",children:"Biological sex"})}),e.jsx(ie,{value:t?.gender||"male",onValueChange:ue,className:"w-full",children:e.jsxs(z,{className:"grid w-full grid-cols-2 border border-border bg-secondary",children:[e.jsx(L,{value:"male",className:"text-foreground data-[state=inactive]:border-muted-foreground/20 data-[state=active]:bg-primary data-[state=inactive]:bg-transparent data-[state=active]:text-primary-foreground data-[state=inactive]:text-muted-foreground",children:"Male"}),e.jsx(L,{value:"female",className:"text-foreground data-[state=inactive]:border-muted-foreground/20 data-[state=active]:bg-primary data-[state=inactive]:bg-transparent data-[state=active]:text-primary-foreground data-[state=inactive]:text-muted-foreground",children:"Female"})]})})]}),e.jsxs("div",{className:"-mx-2 flex cursor-pointer items-center justify-between rounded border-b border-border px-2 py-3 hover:bg-secondary/20",onClick:()=>n(!0),children:[e.jsx("div",{className:"text-base font-medium text-foreground",children:"Height"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-muted-foreground",children:t?.height?d(t.height):"Not set"}),e.jsx(K,{className:"h-4 w-4 text-muted-foreground"})]})]})]})}),!1,e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"border-b border-border pb-3 text-sm font-medium uppercase tracking-wide text-muted-foreground",children:"Settings"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border-b border-border py-4",children:[e.jsx("div",{className:"mb-3",children:e.jsx("div",{className:"text-base font-medium text-foreground",children:"Units"})}),e.jsx(ie,{value:m?.units||"imperial",onValueChange:S=>o({units:S}),className:"w-full",children:e.jsxs(z,{className:"grid w-full grid-cols-2 border border-border bg-secondary",children:[e.jsx(L,{value:"imperial",className:"text-foreground data-[state=inactive]:border-muted-foreground/20 data-[state=active]:bg-primary data-[state=inactive]:bg-transparent data-[state=active]:text-primary-foreground data-[state=inactive]:text-muted-foreground",children:"Imperial (lbs, ft/in)"}),e.jsx(L,{value:"metric",className:"text-foreground data-[state=inactive]:border-muted-foreground/20 data-[state=active]:bg-primary data-[state=inactive]:bg-transparent data-[state=active]:text-primary-foreground data-[state=inactive]:text-muted-foreground",children:"Metric (kg, cm)"})]})})]}),e.jsxs("div",{className:"flex items-center justify-between py-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-medium text-foreground",children:"Notifications"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Enable push notifications"})]}),e.jsx($,{checked:de,onCheckedChange:xe})]}),e.jsxs("div",{className:"border-b border-border py-4",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-medium text-foreground",children:"Sync from Apple HealthKit"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"iOS only"})]}),e.jsx($,{checked:m?.healthKitSyncEnabled||!1,onCheckedChange:me})]}),m?.healthKitSyncEnabled&&e.jsx(Je,{})]}),e.jsxs("div",{className:"flex items-center justify-between py-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-medium text-foreground",children:"Sync from Google Fit"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"All platforms"})]}),e.jsx($,{checked:m?.googleFitSyncEnabled||!1,onCheckedChange:he})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"border-b border-border pb-3 text-sm font-medium uppercase tracking-wide text-muted-foreground",children:"Account"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"-mx-2 flex cursor-pointer items-center justify-between rounded px-2 py-4 hover:bg-secondary/20",onClick:()=>r(!0),children:[e.jsx("div",{className:"text-base font-medium text-foreground",children:"Email"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-muted-foreground",children:t?.email||"Not set"}),e.jsx(K,{className:"h-4 w-4 text-muted-foreground"})]})]}),e.jsxs("div",{className:"-mx-2 flex cursor-pointer items-center justify-between rounded px-2 py-4 hover:bg-secondary/20",onClick:()=>E(!0),children:[e.jsx("div",{className:"text-base font-medium text-foreground",children:"Password"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-muted-foreground",children:"••••••••"}),e.jsx(K,{className:"h-4 w-4 text-muted-foreground"})]})]})]}),e.jsxs("div",{className:"border-t border-border pt-6",children:[e.jsx("h2",{className:"mb-6 border-b border-border pb-3 text-sm font-medium uppercase tracking-wide text-muted-foreground",children:"Security"}),e.jsx(We,{})]}),e.jsxs("div",{className:"border-t border-border pt-6",children:[e.jsx("h2",{className:"mb-6 border-b border-border pb-3 text-sm font-medium uppercase tracking-wide text-muted-foreground",children:"System Status"}),e.jsx(ze,{})]}),e.jsxs("div",{className:"border-t border-border pt-6",children:[e.jsx("h2",{className:"mb-6 border-b border-border pb-3 text-sm font-medium uppercase tracking-wide text-muted-foreground",children:"HealthKit Integration"}),e.jsx(Ke,{})]}),e.jsxs("div",{className:"border-t border-border pt-6",children:[e.jsx("h2",{className:"mb-6 border-b border-border pb-3 text-sm font-medium uppercase tracking-wide text-muted-foreground",children:"RevenueCat Integration"}),e.jsx(Ve,{})]}),e.jsxs("div",{className:"border-t border-border pt-6",children:[e.jsx("h2",{className:"mb-6 border-b border-border pb-3 text-sm font-medium uppercase tracking-wide text-muted-foreground",children:"Version Information"}),e.jsx(_e,{showBuildInfo:!0})]}),e.jsx("div",{className:"border-t border-border pt-6",children:e.jsxs("div",{className:"-mx-2 flex cursor-pointer items-center justify-between rounded px-2 py-4 hover:bg-secondary/20",onClick:je,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Re,{className:"h-4 w-4 text-destructive"}),e.jsx("div",{className:"text-base font-medium text-destructive",children:"Logout"})]}),e.jsx(re,{className:"h-4 w-4 rotate-180 text-muted-foreground"})]})})]})]}),e.jsx(R,{open:p,onOpenChange:b,children:e.jsxs(_,{className:"max-w-md border-border bg-background text-foreground",children:[e.jsx(M,{children:e.jsx(F,{className:"text-xl font-semibold",children:"Edit Name"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"name",children:"Name"}),e.jsx(q,{id:"name",value:i,onChange:S=>g(S.target.value),className:"border-border bg-secondary text-foreground"})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(C,{variant:"outline",onClick:()=>b(!1),className:"flex-1",children:"Cancel"}),e.jsx(C,{onClick:fe,className:"flex-1",children:"Save"})]})]})]})}),e.jsx(R,{open:v,onOpenChange:c,children:e.jsxs(_,{className:"max-w-md border-border bg-background text-foreground",children:[e.jsx(M,{children:e.jsx(F,{className:"text-xl font-semibold",children:"Edit Birthday"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{children:"Birthday"}),e.jsx(qe,{date:N,onDateChange:T,className:"h-60"})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(C,{variant:"outline",onClick:()=>c(!1),className:"flex-1",children:"Cancel"}),e.jsx(C,{onClick:ge,className:"flex-1",children:"Save"})]})]})]})}),e.jsx(R,{open:a,onOpenChange:n,children:e.jsxs(_,{className:"max-w-md border-border bg-background text-foreground",children:[e.jsx(M,{children:e.jsx(F,{className:"text-xl font-semibold",children:"Edit Height"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{children:"Height"}),e.jsx($e,{heightInCm:D,units:m?.units||"imperial",onHeightChange:y,className:"h-60"})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(C,{variant:"outline",onClick:()=>n(!1),className:"flex-1",children:"Cancel"}),e.jsx(C,{onClick:pe,className:"flex-1",children:"Save"})]})]})]})}),e.jsx(R,{open:f,onOpenChange:r,children:e.jsxs(_,{className:"max-w-md border-border bg-background text-foreground",children:[e.jsx(M,{children:e.jsx(F,{className:"text-xl font-semibold",children:"Edit Email"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"email",children:"Email"}),e.jsx(q,{id:"email",type:"email",value:w,onChange:S=>k(S.target.value),className:"border-border bg-secondary text-foreground"})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(C,{variant:"outline",onClick:()=>r(!1),className:"flex-1",children:"Cancel"}),e.jsx(C,{onClick:be,className:"flex-1",children:"Save"})]})]})]})}),e.jsx(R,{open:j,onOpenChange:E,children:e.jsxs(_,{className:"max-w-md border-border bg-background text-foreground",children:[e.jsx(M,{children:e.jsx(F,{className:"text-xl font-semibold",children:"Change Password"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"password",children:"New Password"}),e.jsx(q,{id:"password",type:"password",value:le,onChange:S=>J(S.target.value),className:"border-border bg-secondary text-foreground",placeholder:"Enter new password"})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(C,{variant:"outline",onClick:()=>E(!1),className:"flex-1",children:"Cancel"}),e.jsx(C,{onClick:ve,className:"flex-1",children:"Update Password"})]})]})]})})]})})};export{us as default};
