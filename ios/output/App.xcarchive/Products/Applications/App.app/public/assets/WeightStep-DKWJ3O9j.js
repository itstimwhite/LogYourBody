import{j as t}from"./ui-vendor-QE-oobKj.js";import{a as l}from"./react-vendor-ClhmtWht.js";import{f as q,k as z,i as G,m as s,g,A as P,t as y,H as f,I as $}from"./index-CyPnvWQK.js";import{u as M,w as c,a as k}from"./Dashboard-CWZnxi31.js";import{w as O,a as x}from"./weight-logging-BIZ1MV3J.js";import{S as Q,L as B,d as J}from"./utils-vendor-BSj6XY88.js";import"./data-vendor-DLfSSb0Z.js";import"./analytics-vendor-CXgENQ1a.js";import"./use-supabase-body-metrics-B5fccTwE.js";import"./input-BuoCXOhS.js";import"./label-DALfSSFr.js";import"./VersionDisplay-8Gv_tqWh.js";import"./use-swipe-navigation-eIglpj1B.js";function dt({value:v,onChange:S}){const{setCanGoNext:u}=M(),[n,m]=l.useState(v.value>0?v.value.toString():""),[a,D]=l.useState(v.unit),[W,_]=l.useState(!1),[p,b]=l.useState(!1),w=l.useRef(null),h=q.isNativePlatform(),d=z(),H=G()&&(d.loading?!0:d.isAvailable);l.useEffect(()=>{const e=setTimeout(()=>{w.current?.focus(),c.startStep(1)},300);return()=>clearTimeout(e)},[]),l.useEffect(()=>{const e=parseFloat(n);if(isNaN(e)||n===""){u(!1);return}const i={value:e,unit:a};try{O.parse(i),S(i),u(!0)}catch{u(!1)}},[n,a,S,u]);const A=e=>{b(!0);const i=e.replace(/[^0-9.]/g,""),r=i.split("."),L=r.length>2?`${r[0]}.${r.slice(1).join("")}`:i,[K,C]=L.split("."),F=C?`${K}.${C.slice(0,1)}`:K;if(m(F),p){const R=k.getPrecision(parseFloat(F)||0);c.trackWeightInput({method:"manual_typing",unit_toggle_used:!1,precision_decimals:R})}},I=async()=>{h&&await f.impact({style:$.Light});const e={value:parseFloat(n)||0,unit:a},i=a==="lbs"?"kg":"lbs",r=x.convertWeight(e,i);D(i),m(r.value.toString()),c.trackWeightInput({method:"manual_typing",unit_toggle_used:!0,precision_decimals:k.getPrecision(r.value)})},T=async e=>{h&&await f.impact({style:$.Light}),m(e.toString()),b(!0),c.trackWeightInput({method:"preset_chip",unit_toggle_used:!1,precision_decimals:0})},V=async()=>{if(H){_(!0);try{if(!d.isAuthorized&&!await d.requestPermissions()){y({title:"HealthKit Access Required",description:"Please grant access to import your weight data",variant:"destructive"});return}const e=await d.getHealthData();if(e&&e.weight){const i={value:e.weight,unit:"kg"},r=x.convertWeight(i,a);m(r.value.toString()),b(!0),c.trackWeightInput({method:"healthkit_import",unit_toggle_used:!1,precision_decimals:k.getPrecision(r.value)}),h&&await f.notification({type:"success"}),y({title:"Weight Imported",description:`${r.value} ${r.unit} from HealthKit`})}else y({title:"No Weight Data",description:"No recent weight data found in HealthKit",variant:"destructive"})}catch(e){console.error("HealthKit import error:",e),y({title:"Import Failed",description:"Could not import weight from HealthKit",variant:"destructive"}),h&&await f.notification({type:"error"})}finally{_(!1)}}},E=e=>{if(e.key==="Enter"||e.key==="Done"){e.preventDefault(),w.current?.blur();const i=parseFloat(n)||0;i>=30&&i<=700&&c.completeStep({step_number:1,step_name:"weight",interaction_type:"keyboard",value:`${i} ${a}`})}},U=x.getWeightPresets(a),o=parseFloat(n)||0,j=o>0?x.getWeightHelper({value:o,unit:a}):"",N=o>=30&&o<=700;return t.jsxs(s.div,{className:"space-y-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.25,type:"spring",damping:20},children:[t.jsxs("div",{className:"space-y-4 text-center",children:[t.jsx(s.div,{className:"mx-auto flex h-20 w-20 items-center justify-center rounded-3xl bg-primary/10",whileHover:{scale:1.05},whileTap:{scale:.95},children:t.jsx(Q,{className:"h-10 w-10 text-primary"})}),t.jsxs("div",{children:[t.jsx("h1",{className:"mb-2 text-3xl font-bold text-foreground",children:"What's your weight?"}),t.jsx("p",{className:"text-lg text-muted-foreground",children:"Enter your current weight measurement"})]})]}),H&&t.jsx(s.button,{onClick:V,disabled:W,className:"flex h-14 w-full items-center justify-center gap-3 rounded-2xl border-2 border-transparent bg-secondary/20 transition-colors hover:border-border disabled:opacity-50",whileTap:{scale:.98},initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.1,duration:.25},children:W?t.jsxs(t.Fragment,{children:[t.jsx(B,{className:"h-5 w-5 animate-spin text-primary"}),t.jsx("span",{className:"font-medium text-foreground",children:"Importing from HealthKit..."})]}):t.jsxs(t.Fragment,{children:[t.jsx(J,{className:"h-5 w-5 text-primary"}),t.jsx("span",{className:"font-medium text-foreground",children:"Import from HealthKit"})]})}),t.jsx(s.div,{className:"flex justify-center",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2,duration:.25},children:t.jsxs("div",{className:"flex rounded-2xl bg-secondary/30 p-1",children:[t.jsx("button",{onClick:I,className:g("rounded-xl px-6 py-3 font-medium transition-all duration-200",a==="lbs"?"bg-primary text-primary-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:"lbs"}),t.jsx("button",{onClick:I,className:g("rounded-xl px-6 py-3 font-medium transition-all duration-200",a==="kg"?"bg-primary text-primary-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:"kg"})]})}),t.jsxs(s.div,{className:"space-y-3",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3,duration:.25},children:[t.jsxs("div",{className:"relative",children:[t.jsx("input",{ref:w,type:"text",inputMode:"decimal",pattern:"[0-9]+([.,][0-9]{1})?",value:n,onChange:e=>A(e.target.value),onKeyDown:E,placeholder:a==="lbs"?"150.0":"68.0",className:g("h-16 w-full px-6 text-center text-3xl font-bold","rounded-2xl border-2 bg-secondary/20","text-foreground placeholder:text-muted-foreground/50","transition-all duration-200","focus:border-primary focus:bg-background focus:outline-none focus:ring-4 focus:ring-primary/20",!N&&p&&o>0&&"border-destructive focus:border-destructive focus:ring-destructive/20"),"aria-label":`Weight in ${a}`,"aria-invalid":!N&&p&&o>0}),t.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 transform text-xl font-medium text-muted-foreground",children:a})]}),t.jsx(P,{mode:"wait",children:j&&t.jsx(s.p,{className:"text-center text-lg text-muted-foreground",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},transition:{duration:.2},children:j},j)}),t.jsx(P,{mode:"wait",children:!N&&p&&o>0&&t.jsx(s.p,{className:"text-center text-destructive",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},transition:{duration:.2},role:"alert",children:o<30?"Weight must be at least 30 lbs (13.6 kg)":"Weight must be less than 700 lbs (317.5 kg)"})})]}),t.jsxs(s.div,{className:"space-y-3",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.4,duration:.25},children:[t.jsx("p",{className:"text-center text-sm font-medium text-muted-foreground",children:"Quick presets"}),t.jsx("div",{className:"scrollbar-hide flex gap-2 overflow-x-auto pb-2",children:U.map(e=>t.jsxs(s.button,{onClick:()=>T(e),className:g("flex-shrink-0 rounded-xl border-2 px-4 py-3 font-medium transition-all duration-200",parseFloat(n)===e?"border-primary bg-primary text-primary-foreground":"border-transparent bg-secondary/20 text-foreground hover:border-border"),whileTap:{scale:.95},children:[e," ",a]},e))})]})]})}export{dt as WeightStep};
