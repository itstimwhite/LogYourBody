import{j as e}from"./ui-vendor-QE-oobKj.js";import{a as l,u as A}from"./react-vendor-ClhmtWht.js";import{B as u,g as w,a as v}from"./index-C6tVOIHe.js";import{R as D}from"./RevenueCatPaywall-BIJEpRxf.js";import{X as S,i as k,e as I,j as R,k as E,o as B,I as y,b as P,B as U,z as L}from"./utils-vendor-BSj6XY88.js";import{u as M}from"./use-swipe-navigation-eIglpj1B.js";import"./data-vendor-DLfSSb0Z.js";import"./analytics-vendor-CXgENQ1a.js";import"./switch-BZ6u6mig.js";const z={status:"trial",trialStartDate:new Date(Date.now()-24*60*60*1e3),trialEndDate:new Date(Date.now()+2*24*60*60*1e3),isTrialActive:!0,daysRemainingInTrial:2},F={nextBillingDate:new Date(Date.now()+2*24*60*60*1e3),paymentMethod:"Apple Pay",amount:9.99,currency:"USD"};function C(){const[a,r]=l.useState(z),[o,x]=l.useState(F),[g,c]=l.useState(!1),i=l.useCallback(()=>{if(!a.trialStartDate||!a.trialEndDate)return{isTrialActive:!1,daysRemainingInTrial:0};const s=new Date,t=a.trialEndDate,n=s<t,f=Math.max(0,Math.ceil((t.getTime()-s.getTime())/(1e3*60*60*24)));return{isTrialActive:n,daysRemainingInTrial:f}},[a.trialStartDate,a.trialEndDate]),d=l.useMemo(()=>{const{isTrialActive:s}=i();return a.status==="active"||s},[a.status,i]),h=l.useMemo(()=>{const{isTrialActive:s}=i();return a.status==="trial"&&!s},[a.status,i]),m=l.useCallback(async()=>{c(!0);try{console.log("Initializing RevenueCat..."),await new Promise(n=>setTimeout(n,1e3));const{isTrialActive:s,daysRemainingInTrial:t}=i();r(n=>({...n,isTrialActive:s,daysRemainingInTrial:t}))}catch(s){console.error("Failed to initialize RevenueCat:",s)}finally{c(!1)}},[i]),p=l.useCallback(async()=>{c(!0);try{const s=new Date,t=new Date(s.getTime()+3*24*60*60*1e3);r({status:"trial",trialStartDate:s,trialEndDate:t,isTrialActive:!0,daysRemainingInTrial:3}),console.log("Trial started")}catch(s){console.error("Failed to start trial:",s)}finally{c(!1)}},[]),j=l.useCallback(async s=>{c(!0);try{console.log("Purchasing subscription:",s),await new Promise(f=>setTimeout(f,2e3));const t=new Date,n=new Date(t.getTime()+30*24*60*60*1e3);return r({status:"active",subscriptionStartDate:t,subscriptionEndDate:n,productId:s,isTrialActive:!1,daysRemainingInTrial:0}),x({nextBillingDate:n,lastPaymentDate:t,paymentMethod:"Apple Pay",amount:s.includes("yearly")?79.99:9.99,currency:"USD"}),{success:!0}}catch(t){return console.error("Purchase failed:",t),{success:!1,error:t}}finally{c(!1)}},[]),b=l.useCallback(async()=>{c(!0);try{return console.log("Restoring purchases..."),await new Promise(s=>setTimeout(s,1e3)),{success:!0}}catch(s){return console.error("Restore failed:",s),{success:!1,error:s}}finally{c(!1)}},[]),N=l.useCallback(async()=>{const t=/iPad|iPhone|iPod/.test(navigator.userAgent)?"https://apps.apple.com/account/subscriptions":"https://play.google.com/store/account/subscriptions";window.open(t,"_blank")},[]);return l.useEffect(()=>{m()},[m]),l.useEffect(()=>{const s=setInterval(()=>{const{isTrialActive:t,daysRemainingInTrial:n}=i();r(f=>({...f,isTrialActive:t,daysRemainingInTrial:n}))},6e4);return()=>clearInterval(s)},[i]),{subscriptionInfo:a,billingInfo:o,isLoading:g,hasAccess:d,isTrialExpired:h,startTrial:p,purchaseSubscription:j,restorePurchases:b,cancelSubscription:N,initializeRevenueCat:m}}const T=[{id:"monthly",name:"Monthly",price:"$9.99",period:"monthly",features:["Unlimited body measurements","Advanced analytics & trends","Photo progress tracking","Health app sync","Export data","Priority support"],revenueCatProductId:"logyourbody_monthly"},{id:"yearly",name:"Annual",price:"$69.99",period:"yearly",features:["Unlimited body measurements","Advanced analytics & trends","Photo progress tracking","Health app sync","Export data","Priority support","Save 42% vs monthly"],isPopular:!0,revenueCatProductId:"logyourbody_yearly"}];function $({onClose:a,title:r="Access Paused",subtitle:o="Continue tracking your body composition with LogYourBody Premium",showCloseButton:x=!1}){const{purchaseSubscription:g,isLoading:c,subscriptionInfo:i}=C(),[d,h]=l.useState(T[1].id),[m,p]=l.useState(!0),j=()=>{a?.()},b=t=>{console.error("RevenueCat error:",t),p(!1)},N=async()=>{const t=T.find(n=>n.id===d);t&&(await g(t.revenueCatProductId)).success&&a&&a()},s=[{icon:k,title:"Advanced Analytics",subtitle:"& Trends"},{icon:I,title:"Progress Tracking",subtitle:"& Insights"},{icon:R,title:"Photo Progress",subtitle:"Tracking"},{icon:E,title:"Health App",subtitle:"Sync"}];return m?e.jsxs("div",{className:"fixed inset-0 z-50 flex flex-col bg-background",children:[e.jsxs("div",{className:"flex items-center justify-between p-6",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"LogYourBody"}),x&&a&&e.jsx(u,{size:"icon",variant:"ghost",onClick:a,className:"h-8 w-8 text-muted-foreground hover:text-foreground",children:e.jsx(S,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6",children:e.jsxs("div",{className:"mx-auto max-w-md space-y-8",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h1",{className:"text-4xl font-light text-foreground",children:r.split(" ")[0]||"ACCESS"}),e.jsx("h2",{className:"text-4xl font-bold text-primary",children:r.split(" ")[1]||"PAUSED"}),e.jsx("p",{className:"text-lg text-muted-foreground",children:o}),i.isTrialActive&&e.jsxs("div",{className:"text-sm font-medium text-primary",children:[i.daysRemainingInTrial," days left in trial"]})]}),e.jsx(D,{onSuccess:j,onError:b}),e.jsx("div",{className:"flex justify-center",children:e.jsx(u,{variant:"ghost",onClick:()=>window.open("mailto:support@logyourbody.com?subject=LogYourBody Support Request","_blank"),className:"text-muted-foreground hover:text-foreground",children:"Need Help?"})})]})})]}):e.jsxs("div",{className:"fixed inset-0 z-50 flex flex-col bg-background",children:[e.jsxs("div",{className:"flex items-center justify-between p-6",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"LogYourBody"}),x&&a&&e.jsx(u,{size:"icon",variant:"ghost",onClick:a,className:"h-8 w-8 text-muted-foreground hover:text-foreground",children:e.jsx(S,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6",children:e.jsxs("div",{className:"mx-auto max-w-md space-y-8",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h1",{className:"text-4xl font-light text-foreground",children:"ACCESS"}),e.jsx("h2",{className:"text-4xl font-bold text-primary",children:"PAUSED"}),e.jsx("p",{className:"text-lg text-muted-foreground",children:o}),i.isTrialActive&&e.jsxs("div",{className:"text-sm font-medium text-primary",children:[i.daysRemainingInTrial," days left in trial"]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:s.map((t,n)=>e.jsxs("div",{className:"rounded-lg border border-border bg-secondary/30 p-4",children:[e.jsx(t.icon,{className:"mb-3 h-8 w-8 text-primary"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm font-semibold text-foreground",children:t.title}),e.jsx("div",{className:"text-sm text-muted-foreground",children:t.subtitle})]})]},n))}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{onClick:()=>h("yearly"),className:w("relative cursor-pointer rounded-lg border-2 p-4 transition-all",d==="yearly"?"border-primary bg-primary/5":"border-border bg-secondary/30"),children:[d==="yearly"&&e.jsx(v,{className:"absolute -top-2 right-4 bg-primary text-xs text-primary-foreground",children:"Save 42% with Annual"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xl font-semibold text-foreground",children:"Annual"}),e.jsx("div",{className:"text-muted-foreground",children:"$69.99 billed yearly"})]}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:"text-xl font-bold text-foreground",children:"$5.83/mo"})})]})]}),e.jsx("div",{onClick:()=>h("monthly"),className:w("relative cursor-pointer rounded-lg border-2 p-4 transition-all",d==="monthly"?"border-primary bg-primary/5":"border-border bg-secondary/30"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xl font-semibold text-foreground",children:"Monthly"}),e.jsx("div",{className:"text-muted-foreground",children:"$9.99 billed monthly"})]}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:"text-xl font-bold text-foreground",children:"$9.99/mo"})})]})})]})]})}),e.jsxs("div",{className:"space-y-4 p-6",children:[e.jsx(u,{onClick:N,disabled:c,className:"h-14 w-full rounded-xl bg-primary text-lg font-semibold text-primary-foreground hover:bg-primary/90",children:c?"Processing...":"Resume Now"}),e.jsx("div",{className:"flex justify-center",children:e.jsx(u,{variant:"ghost",onClick:()=>window.open("mailto:support@logyourbody.com?subject=LogYourBody Support Request","_blank"),disabled:c,className:"text-muted-foreground hover:text-foreground",children:"Need Help?"})}),e.jsx("p",{className:"text-center text-xs leading-relaxed text-muted-foreground",children:"Subscription automatically renews unless cancelled. Cancel anytime in your account settings. By subscribing you agree to our Terms of Service and Privacy Policy."})]})]})}const Q=()=>{const a=A(),{subscriptionInfo:r,billingInfo:o,cancelSubscription:x,isLoading:g}=C(),[c,i]=l.useState(!1);M({onSwipeRight:()=>a("/settings"),threshold:100});const d=m=>m?m.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"N/A",h=()=>{switch(r.status){case"trial":return e.jsx(v,{variant:"outline",className:"border-primary text-primary",children:"Trial Active"});case"active":return e.jsx(v,{className:"bg-green-500 text-white",children:"Active"});case"expired":case"cancelled":return e.jsx(v,{variant:"destructive",children:"Expired"});default:return null}};return c?e.jsx($,{onClose:()=>i(!1),showCloseButton:!0}):e.jsxs("div",{className:"min-h-screen bg-background text-foreground",children:[e.jsxs("div",{className:"flex items-center gap-4 border-b border-border px-6 py-4",children:[e.jsx(u,{size:"icon",variant:"outline",onClick:()=>a("/settings"),className:"h-10 w-10 border-border bg-secondary text-foreground hover:bg-muted",children:e.jsx(B,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{className:"h-5 w-5 text-primary"}),e.jsx("h1",{className:"text-xl font-semibold tracking-tight",children:"Subscription"})]})]}),e.jsxs("div",{className:"space-y-8 p-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Current Plan"}),h()]}),e.jsx("div",{className:"space-y-4 rounded-lg bg-secondary/30 p-6",children:r.status==="trial"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-primary/10",children:e.jsx(y,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-foreground",children:"Free Trial"}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[r.daysRemainingInTrial," days remaining"]})]})]}),r.trialEndDate&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(P,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{className:"text-muted-foreground",children:["Trial ends on ",d(r.trialEndDate)]})]}),e.jsx(u,{onClick:()=>i(!0),className:"w-full bg-primary text-primary-foreground hover:bg-primary/90",children:"Upgrade to Premium"})]}):r.status==="active"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-green-500/10",children:e.jsx(y,{className:"h-6 w-6 text-green-500"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-foreground",children:"Premium"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Active subscription"})]})]}),r.subscriptionEndDate&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(P,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{className:"text-muted-foreground",children:["Renews on"," ",d(r.subscriptionEndDate)]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-destructive/10",children:e.jsx(U,{className:"h-6 w-6 text-destructive"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-foreground",children:"Subscription Expired"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Reactivate to continue using LogYourBody"})]})]}),e.jsx(u,{onClick:()=>i(!0),className:"w-full bg-primary text-primary-foreground hover:bg-primary/90",children:"Reactivate Premium"})]})})]}),r.status==="active"&&o&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Billing Information"}),e.jsxs("div",{className:"space-y-4 rounded-lg bg-secondary/30 p-6",children:[o.nextBillingDate&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Next billing date"}),e.jsx("span",{className:"font-medium text-foreground",children:d(o.nextBillingDate)})]}),o.amount&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Amount"}),e.jsxs("span",{className:"font-medium text-foreground",children:["$",o.amount," ",o.currency]})]}),o.paymentMethod&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Payment method"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium text-foreground",children:o.paymentMethod})]})]})]})]}),r.status==="active"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Manage Subscription"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(u,{variant:"outline",onClick:x,disabled:g,className:"w-full",children:"Manage in App Store"}),e.jsx("p",{className:"text-center text-xs text-muted-foreground",children:"To cancel or modify your subscription, use your device's App Store or Google Play settings."})]})]}),r.status!=="active"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Premium Features"}),e.jsx("div",{className:"space-y-3 rounded-lg bg-secondary/30 p-6",children:["Unlimited body measurements","Advanced analytics & trends","Photo progress tracking","Health app sync","Export data","Priority support"].map((m,p)=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(y,{className:"h-4 w-4 flex-shrink-0 text-primary"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:m})]},p))})]})]})]})};export{Q as default};
