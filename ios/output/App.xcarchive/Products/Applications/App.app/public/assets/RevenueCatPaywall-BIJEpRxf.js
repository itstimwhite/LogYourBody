import{j as e}from"./ui-vendor-QE-oobKj.js";import{a as c}from"./react-vendor-ClhmtWht.js";import{u as F,f as k,a as O,C as _,b as M,c as D,e as T,d as U,B as W,t as R}from"./index-C6tVOIHe.js";import{S as $}from"./switch-BZ6u6mig.js";import{d as f}from"./data-vendor-DLfSSb0Z.js";import{L as S,n as z}from"./utils-vendor-BSj6XY88.js";function B(){const{user:n}=F(),[l,r]=c.useState({isConfigured:!1,isLoading:!0,customerInfo:null,offerings:null,error:null});c.useEffect(()=>{(async()=>{try{const t=k.isNativePlatform()&&k.getPlatform()==="ios",s=t?"appl_dJsnXzyTgEAsntJQjOxeOvOnoXP":"strp_kPUxxTPVLFHFRUapUTafrHwSMAE";if(!s)throw new Error(`RevenueCat ${t?"iOS":"Web"} public key not set`);if(s.startsWith("sk_"))throw new Error("RevenueCat secret key detected. Please use the public key");if(t&&!s.startsWith("appl_"))throw new Error("Invalid iOS RevenueCat key format. Should start with 'appl_'");if(!t&&!s.startsWith("strp_")&&!s.startsWith("public_"))throw new Error("Invalid Web RevenueCat key format. Should start with 'strp_' or 'public_'");console.log(`Initializing RevenueCat for ${t?"iOS":"Web"} with key:`,s.substring(0,10)+"..."),await f.configure({apiKey:s,appUserID:n?.id||void 0});const i=await f.getCustomerInfo();r(g=>({...g,isConfigured:!0,isLoading:!1,customerInfo:i,error:null}))}catch(t){console.error("Failed to initialize RevenueCat:",t),t&&typeof t=="object"&&"code"in t&&console.error("RevenueCat error code:",t.code),r(s=>({...s,isLoading:!1,error:t instanceof Error?t.message:"Failed to initialize RevenueCat"}))}})()},[n?.id]);const x=c.useCallback(async a=>{try{r(s=>({...s,isLoading:!0,error:null}));const{customerInfo:t}=await f.purchasePackage(a);return r(s=>({...s,customerInfo:t,isLoading:!1})),t}catch(t){const s=t instanceof Error?t.message:"Purchase failed";throw r(i=>({...i,isLoading:!1,error:s})),t}},[]),m=c.useCallback(async()=>{try{r(t=>({...t,isLoading:!0,error:null}));const a=await f.restorePurchases();return r(t=>({...t,customerInfo:a,isLoading:!1})),a}catch(a){const t=a instanceof Error?a.message:"Restore failed";throw r(s=>({...s,isLoading:!1,error:t})),a}},[]),d=c.useCallback(async()=>{try{const a=await f.getOfferings(),t=Object.values(a.all);return r(s=>({...s,offerings:t})),t}catch(a){const t=a instanceof Error?a.message:"Failed to get offerings";throw r(s=>({...s,error:t})),a}},[]);return{...l,purchasePackage:x,restorePurchases:m,getOfferings:d}}const E=n=>n?!!(n.entitlements.active.pro_features&&n.entitlements.active.pro_features.isActive):!1,q=n=>{if(!n)return{isActive:!1,isInTrial:!1,willRenew:!1,expirationDate:null,productIdentifier:null};const l=n.entitlements.active.pro_features;return l?{isActive:l.isActive,isInTrial:l.willRenew&&l.periodType==="trial",willRenew:l.willRenew,expirationDate:l.expirationDate,productIdentifier:l.productIdentifier}:{isActive:!1,isInTrial:!1,willRenew:!1,expirationDate:null,productIdentifier:null}};function G({onSuccess:n,onError:l}){const{isConfigured:r,isLoading:x,customerInfo:m,offerings:d,error:a,purchasePackage:t,getOfferings:s}=B(),[i,g]=c.useState("annual"),[p,v]=c.useState(!1);c.useEffect(()=>{r&&!d&&s().catch(console.error)},[r,d,s]),c.useEffect(()=>{m&&E(m)&&n?.()},[m,n]);const I=async o=>{if(!p){v(!0);try{const u=await t(o);if(E(u))R({title:"Purchase Successful!",description:"Welcome to LogYourBody Pro! Enjoy all premium features."}),n?.();else throw new Error("Purchase completed but pro features not activated")}catch(u){const C=u instanceof Error?u.message:"Purchase failed";console.error("Purchase error:",u),R({title:"Purchase Failed",description:C,variant:"destructive"}),l?.(C)}finally{v(!1)}}};if(!r)return e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"mb-2 text-lg font-semibold",children:"Payment System Unavailable"}),e.jsx("p",{className:"text-muted-foreground",children:a||"RevenueCat is not configured. Please contact support."})]})});if(x||!d)return e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx(S,{className:"mx-auto mb-2 h-8 w-8 animate-spin"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading payment options..."})]})});const y=d.find(o=>o.identifier==="default")||d[0];if(!y)return e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"mb-2 text-lg font-semibold",children:"No Plans Available"}),e.jsx("p",{className:"text-muted-foreground",children:"No subscription plans are currently available. Please try again later."})]})});const j=y.availablePackages.find(o=>o.identifier==="monthly"||o.rcBillingPeriod?.unit==="month"),b=y.availablePackages.find(o=>o.identifier==="annual"||o.rcBillingPeriod?.unit==="year"),h=i==="annual"?b:j,L=["Unlimited body measurements","Advanced analytics & trends","Progress photo tracking","Health app synchronization","Data export capabilities","Priority customer support","Detailed progress insights","FFMI calculations"],N=j?.product.price||9.99,P=(b?.product.price||69.99)/12,w=N-P,A=Math.round(w/N*100);return e.jsxs("div",{className:"mx-auto max-w-md p-6",children:[e.jsxs("div",{className:"mb-8 text-center",children:[e.jsx("h2",{className:"mb-2 text-2xl font-bold",children:"Upgrade to Pro"}),e.jsx("p",{className:"text-muted-foreground",children:"Unlock all features and get the most out of your body composition tracking"})]}),e.jsxs("div",{className:"mb-8 flex items-center justify-center gap-4",role:"group",children:[e.jsx("span",{className:`text-sm font-medium ${i==="monthly"?"text-foreground":"text-muted-foreground"}`,children:"Monthly"}),e.jsx($,{checked:i==="annual",onCheckedChange:o=>g(o?"annual":"monthly"),className:"data-[state=checked]:bg-primary"}),e.jsx("span",{className:`text-sm font-medium ${i==="annual"?"text-foreground":"text-muted-foreground"}`,children:"Annual"}),i==="annual"&&e.jsxs(O,{className:"ml-2 border-green-200 bg-green-100 text-green-800",children:["Save ",A,"%"]})]}),e.jsxs(_,{className:"mb-6 ring-2 ring-primary",children:[e.jsxs(M,{className:"text-center",children:[e.jsx(D,{className:"text-xl",children:"LogYourBody Pro"}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("span",{className:"text-3xl font-bold",children:["$",h?.product.price||(i==="annual"?"69.99":"9.99")]}),e.jsxs("span",{className:"text-muted-foreground",children:["/",i==="annual"?"year":"month"]})]}),i==="annual"&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:["$",P.toFixed(2),"/month when billed annually"]}),e.jsxs("div",{className:"text-sm font-medium text-green-600",children:["Save $",(w*12).toFixed(2)," vs monthly billing"]})]}),e.jsx(T,{className:"mt-4 text-base",children:"Professional body composition tracking with advanced analytics"})]}),e.jsxs(U,{children:[e.jsx("ul",{className:"mb-6 space-y-3",children:L.map((o,u)=>e.jsxs("li",{className:"flex items-center",children:[e.jsx(z,{className:"mr-3 h-4 w-4 flex-shrink-0 text-primary"}),e.jsx("span",{className:"text-sm",children:o})]},u))}),e.jsx(W,{className:"w-full",onClick:()=>h&&I(h),disabled:p||!h,children:p?e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"mr-2 h-4 w-4 animate-spin"}),"Processing..."]}):`Start ${i==="annual"?"Annual":"Monthly"} Plan`}),e.jsx("p",{className:"mt-3 text-center text-xs text-muted-foreground",children:"Secure payment • Cancel anytime • No hidden fees"})]})]}),a&&e.jsx("div",{className:"mb-4 text-center text-sm text-destructive",children:a})]})}export{G as R,q as g,E as h,B as u};
