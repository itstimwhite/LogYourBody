import{j as t}from"./ui-vendor-B29bBmtv.js";import{a as o}from"./react-vendor-CGPzL8fz.js";import{g as q,n as z,h as G,m as n,c as x,A as P,t as g,H as y,I as $}from"./index-BXn5fie0.js";import{u as M,w as c,a as k}from"./Dashboard-BEtRgZCw.js";import{w as O,a as f}from"./weight-logging-DDOSsiCQ.js";import{S as Q,L as B,d as J}from"./utils-vendor-eZsCaz-O.js";import"./data-vendor-CtvEhjhB.js";import"./analytics-vendor-CXgENQ1a.js";import"./use-is-mounted-BS5eygNt.js";import"./focus-management-6kc7Qb5h.js";import"./use-supabase-body-metrics-BQdYD7Am.js";import"./input-CNy6IyKs.js";import"./label-Cv8kb5SZ.js";import"./progress-BAm9950D.js";import"./VersionDisplay-hsVI5a3E.js";import"./prefetch-DuFvdqm2.js";import"./use-swipe-navigation-Br04oNeb.js";function ht({value:b,onChange:S}){const{setCanGoNext:p}=M(),[s,u]=o.useState(b.value>0?b.value.toString():""),[i,D]=o.useState(b.unit),[W,_]=o.useState(!1),[m,v]=o.useState(!1),w=o.useRef(null),h=q.isNativePlatform(),d=z(),H=G()&&(d.loading?!0:d.isAvailable);o.useEffect(()=>{const e=setTimeout(()=>{w.current?.focus(),c.startStep(1)},300);return()=>clearTimeout(e)},[]),o.useEffect(()=>{const e=parseFloat(s);if(isNaN(e)||s===""){p(!1);return}const a={value:e,unit:i};try{O.parse(a),S(a),p(!0)}catch{p(!1)}},[s,i,S,p]);const A=e=>{v(!0);const a=e.replace(/[^0-9.]/g,""),r=a.split("."),L=r.length>2?`${r[0]}.${r.slice(1).join("")}`:a,[K,C]=L.split("."),F=C?`${K}.${C.slice(0,1)}`:K;if(u(F),m){const R=k.getPrecision(parseFloat(F)||0);c.trackWeightInput({method:"manual_typing",unit_toggle_used:!1,precision_decimals:R})}},I=async()=>{h&&await y.impact({style:$.Light});const e={value:parseFloat(s)||0,unit:i},a=i==="lbs"?"kg":"lbs",r=f.convertWeight(e,a);D(a),u(r.value.toString()),c.trackWeightInput({method:"manual_typing",unit_toggle_used:!0,precision_decimals:k.getPrecision(r.value)})},T=async e=>{h&&await y.impact({style:$.Light}),u(e.toString()),v(!0),c.trackWeightInput({method:"preset_chip",unit_toggle_used:!1,precision_decimals:0})},V=async()=>{if(H){_(!0);try{if(!d.isAuthorized&&!await d.requestPermissions()){g({title:"HealthKit Access Required",description:"Please grant access to import your weight data",variant:"destructive"});return}const e=await d.getHealthData();if(e&&e.weight){const a={value:e.weight,unit:"kg"},r=f.convertWeight(a,i);u(r.value.toString()),v(!0),c.trackWeightInput({method:"healthkit_import",unit_toggle_used:!1,precision_decimals:k.getPrecision(r.value)}),h&&await y.notification({type:"success"}),g({title:"Weight Imported",description:`${r.value} ${r.unit} from HealthKit`})}else g({title:"No Weight Data",description:"No recent weight data found in HealthKit",variant:"destructive"})}catch(e){console.error("HealthKit import error:",e),g({title:"Import Failed",description:"Could not import weight from HealthKit",variant:"destructive"}),h&&await y.notification({type:"error"})}finally{_(!1)}}},E=e=>{if(e.key==="Enter"||e.key==="Done"){e.preventDefault(),w.current?.blur();const a=parseFloat(s)||0;a>=30&&a<=700&&c.completeStep({step_number:1,step_name:"weight",interaction_type:"keyboard",value:`${a} ${i}`})}},U=f.getWeightPresets(i),l=parseFloat(s)||0,j=l>0?f.getWeightHelper({value:l,unit:i}):"",N=l>=30&&l<=700;return t.jsxs(n.div,{className:"space-y-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.25,type:"spring",damping:20},children:[t.jsxs("div",{className:"space-y-4 text-center",children:[t.jsx(n.div,{className:"mx-auto flex h-20 w-20 items-center justify-center rounded-3xl bg-linear-purple/10",whileHover:{scale:1.05},whileTap:{scale:.95},children:t.jsx(Q,{className:"h-10 w-10 text-linear-purple"})}),t.jsxs("div",{children:[t.jsx("h1",{className:"mb-2 text-3xl font-bold text-linear-text",children:"What's your weight?"}),t.jsx("p",{className:"text-lg text-linear-text-secondary",children:"Enter your current weight measurement"})]})]}),H&&t.jsx(n.button,{onClick:V,disabled:W,className:"flex h-14 w-full items-center justify-center gap-3 rounded-xl border border-linear-border bg-linear-card transition-colors hover:bg-linear-border/50 disabled:opacity-50",whileTap:{scale:.98},initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.1,duration:.25},children:W?t.jsxs(t.Fragment,{children:[t.jsx(B,{className:"h-5 w-5 animate-spin text-linear-purple"}),t.jsx("span",{className:"font-medium text-linear-text",children:"Importing from HealthKit..."})]}):t.jsxs(t.Fragment,{children:[t.jsx(J,{className:"h-5 w-5 text-linear-purple"}),t.jsx("span",{className:"font-medium text-linear-text",children:"Import from HealthKit"})]})}),t.jsx(n.div,{className:"flex justify-center",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2,duration:.25},children:t.jsxs("div",{className:"flex rounded-xl bg-linear-card border border-linear-border p-1",children:[t.jsx("button",{onClick:I,className:x("rounded-lg px-6 py-3 font-medium transition-all duration-200",i==="lbs"?"bg-linear-purple text-white shadow-xs":"text-linear-text-secondary hover:text-linear-text"),children:"lbs"}),t.jsx("button",{onClick:I,className:x("rounded-lg px-6 py-3 font-medium transition-all duration-200",i==="kg"?"bg-linear-purple text-white shadow-xs":"text-linear-text-secondary hover:text-linear-text"),children:"kg"})]})}),t.jsxs(n.div,{className:"space-y-3",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3,duration:.25},children:[t.jsxs("div",{className:"relative",children:[t.jsx("input",{ref:w,type:"text",inputMode:"decimal",pattern:"[0-9]+([.,][0-9]{1})?",value:s,onChange:e=>A(e.target.value),onKeyDown:E,placeholder:i==="lbs"?"150.0":"68.0",className:x("h-16 w-full px-6 text-center text-3xl font-bold","rounded-xl border border-linear-border bg-linear-card","text-linear-text placeholder:text-linear-text-tertiary/50","transition-all duration-200","focus:border-linear-purple focus:bg-linear-card focus:outline-hidden",!N&&m&&l>0&&"border-red-500 focus:border-red-500 focus:ring-red-500/20"),"aria-label":`Weight in ${i}`,"aria-invalid":!N&&m&&l>0}),t.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 transform text-xl font-medium text-linear-text-secondary",children:i})]}),t.jsx(P,{mode:"wait",children:j&&t.jsx(n.p,{className:"text-center text-lg text-linear-text-secondary",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},transition:{duration:.2},children:j},j)}),t.jsx(P,{mode:"wait",children:!N&&m&&l>0&&t.jsx(n.p,{className:"text-center text-red-500",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},transition:{duration:.2},role:"alert",children:l<30?"Weight must be at least 30 lbs (13.6 kg)":"Weight must be less than 700 lbs (317.5 kg)"})})]}),t.jsxs(n.div,{className:"space-y-3",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.4,duration:.25},children:[t.jsx("p",{className:"text-center text-sm font-medium text-linear-text-tertiary",children:"Quick presets"}),t.jsx("div",{className:"scrollbar-hide flex gap-2 overflow-x-auto pb-2",children:U.map(e=>t.jsxs(n.button,{onClick:()=>T(e),className:x("shrink-0 rounded-xl border px-4 py-3 font-medium transition-all duration-200",parseFloat(s)===e?"border-linear-purple bg-linear-purple text-white":"border-linear-border bg-linear-card text-linear-text hover:bg-linear-border/50"),whileTap:{scale:.95},children:[e," ",i]},e))})]})]})}export{ht as WeightStep};
