const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/web-br6GjorP.js","assets/index-CyPnvWQK.js","assets/ui-vendor-QE-oobKj.js","assets/react-vendor-ClhmtWht.js","assets/data-vendor-DLfSSb0Z.js","assets/utils-vendor-BSj6XY88.js","assets/analytics-vendor-CXgENQ1a.js","assets/index-D1-nO6UG.css"])))=>i.map(i=>d[i]);
import{j as e}from"./ui-vendor-QE-oobKj.js";import{a as o,R as J,u as K,j as Y}from"./react-vendor-ClhmtWht.js";import{s as M,g as X,B as A,C as W,b as F,c as B,e as T,d as V,r as Q,i as $,u as Z,h as ee,j as se,l as te}from"./index-CyPnvWQK.js";import{I as P}from"./input-BuoCXOhS.js";import{L}from"./label-DALfSSFr.js";import{J as _,o as re,k as ne,M as G,f as q}from"./utils-vendor-BSj6XY88.js";import{_ as oe}from"./data-vendor-DLfSSb0Z.js";import{u as ae}from"./use-swipe-navigation-eIglpj1B.js";import{V as ie}from"./VersionDisplay-8Gv_tqWh.js";import"./analytics-vendor-CXgENQ1a.js";function le(){const[f,b]=o.useState(!1),[w,N]=o.useState("phone"),[s,i]=o.useState(""),[m,p]=o.useState(""),[v,r]=o.useState(null),h=o.useCallback(c=>{const l=c.replace(/\D/g,"");return l.length===10?`+1${l}`:l.length===11&&l.startsWith("1")?`+${l}`:`+${l}`},[]),x=o.useCallback(async()=>{if(!s.trim())return r("Please enter a phone number"),!1;b(!0),r(null);try{const c=h(s),{error:l}=await M.auth.signInWithOtp({phone:c,options:{channel:"sms"}});return l?(console.error("SMS send error:",l),r(l.message||"Failed to send verification code"),!1):(N("verification"),_.success("Verification code sent!"),!0)}catch(c){return console.error("SMS send error:",c),r(c.message||"Failed to send verification code"),!1}finally{b(!1)}},[s,h]),I=o.useCallback(async()=>{if(!m.trim()||m.length!==6)return r("Please enter a valid 6-digit verification code"),!1;b(!0),r(null);try{const c=h(s),{data:l,error:S}=await M.auth.verifyOtp({phone:c,token:m,type:"sms"});return S?(console.error("SMS verification error:",S),r(S.message||"Invalid verification code"),!1):l.user?(N("completed"),_.success("Phone number verified successfully!"),!0):(r("Verification failed. Please try again."),!1)}catch(c){return console.error("SMS verification error:",c),r(c.message||"Verification failed"),!1}finally{b(!1)}},[m,s,h]),y=o.useCallback(async()=>await x(),[x]),j=o.useCallback(()=>{N("phone"),i(""),p(""),r(null),b(!1)},[]);return{isLoading:f,step:w,phoneNumber:s,verificationCode:m,setPhoneNumber:i,setVerificationCode:p,sendSMSCode:x,verifySMSCode:I,resendCode:y,resetFlow:j,error:v}}const ce=J.memo(function({onBack:b,onSuccess:w,className:N}){const{isLoading:s,step:i,phoneNumber:m,verificationCode:p,setPhoneNumber:v,setVerificationCode:r,sendSMSCode:h,verifySMSCode:x,resendCode:I,error:y}=le(),[j,c]=o.useState(0),l=o.useRef([]);o.useEffect(()=>{if(i==="verification"){const t=a=>{const d=a.clipboardData?.getData("text");d&&/^\d{6}$/.test(d)&&(r(d),l.current[5]?.focus())};return document.addEventListener("paste",t),()=>document.removeEventListener("paste",t)}},[i,r]),o.useEffect(()=>{if(j>0){const t=setTimeout(()=>c(j-1),1e3);return()=>clearTimeout(t)}},[j]);const S=t=>{const a=t.replace(/\D/g,"");if(a.length>=10){const d=a.slice(-10);return`(${d.slice(0,3)}) ${d.slice(3,6)}-${d.slice(6)}`}return t},C=async t=>{t.preventDefault(),await h()&&c(60)},k=async t=>{t.preventDefault(),await x()&&w()},g=async()=>{if(j>0)return;await I()&&c(60)},D=(t,a)=>{const d=a.replace(/\D/g,"").slice(-1),E=p.split("");E[t]=d,r(E.join("")),d&&t<5&&l.current[t+1]?.focus()},R=(t,a)=>{a.key==="Backspace"&&!p[t]&&t>0&&l.current[t-1]?.focus()};return i==="completed"?(w(),null):e.jsxs("div",{className:X("mx-auto w-full max-w-md",N),children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs(A,{variant:"ghost",size:"sm",onClick:b,className:"-ml-2 mb-4",children:[e.jsx(re,{className:"mr-2 h-4 w-4"}),"Back"]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-primary/10",children:i==="phone"?e.jsx(ne,{className:"h-8 w-8 text-primary"}):e.jsx(G,{className:"h-8 w-8 text-primary"})}),e.jsx("h1",{className:"mb-2 text-2xl font-bold text-foreground",children:i==="phone"?"Sign in with SMS":"Enter verification code"}),e.jsx("p",{className:"text-muted-foreground",children:i==="phone"?"We'll send you a secure code to verify your phone number":`We sent a 6-digit code to ${S(m)}`})]})]}),i==="phone"&&e.jsxs(W,{className:"border-border",children:[e.jsxs(F,{className:"pb-4",children:[e.jsxs(B,{className:"flex items-center gap-2 text-lg",children:[e.jsx(q,{className:"h-5 w-5 text-primary"}),"Phone Number"]}),e.jsx(T,{children:"Enter your mobile phone number to receive a verification code"})]}),e.jsx(V,{children:e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"phone",children:"Phone Number"}),e.jsx(P,{id:"phone",type:"tel",placeholder:"(555) 123-4567",value:m,onChange:t=>v(t.target.value),className:"h-12 text-lg",autoComplete:"tel",autoFocus:!0})]}),y&&e.jsx("div",{className:"rounded-md border border-destructive/20 bg-destructive/10 p-3 text-sm text-destructive",children:y}),e.jsx(A,{type:"submit",className:"h-12 w-full text-base",disabled:s||!m.trim(),children:s?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-current border-r-transparent"}),"Sending code..."]}):"Send verification code"})]})})]}),i==="verification"&&e.jsxs(W,{className:"border-border",children:[e.jsxs(F,{className:"pb-4",children:[e.jsxs(B,{className:"flex items-center gap-2 text-lg",children:[e.jsx(G,{className:"h-5 w-5 text-primary"}),"Verification Code"]}),e.jsx(T,{children:"Enter the 6-digit code sent to your phone"})]}),e.jsx(V,{children:e.jsxs("form",{onSubmit:k,className:"space-y-6",children:[e.jsx("div",{className:"flex justify-center gap-2",children:Array.from({length:6},(t,a)=>e.jsx(P,{ref:d=>l.current[a]=d,type:"text",inputMode:"numeric",maxLength:1,value:p[a]||"",onChange:d=>D(a,d.target.value),onKeyDown:d=>R(a,d),className:"h-12 w-12 text-center font-mono text-lg",autoComplete:"one-time-code",autoFocus:a===0},a))}),y&&e.jsx("div",{className:"rounded-md border border-destructive/20 bg-destructive/10 p-3 text-center text-sm text-destructive",children:y}),e.jsx(A,{type:"submit",className:"h-12 w-full text-base",disabled:s||p.length!==6,children:s?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-current border-r-transparent"}),"Verifying..."]}):"Verify code"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"mb-2 text-sm text-muted-foreground",children:"Didn't receive the code?"}),e.jsx(A,{type:"button",variant:"ghost",size:"sm",onClick:g,disabled:j>0||s,className:"text-primary hover:text-primary/80",children:j>0?`Resend in ${j}s`:"Resend code"})]})]})})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx(q,{className:"mr-1 inline h-3 w-3"}),"Your phone number is encrypted and secure"]})})]})}),z=Q("SignInWithApple",{web:()=>oe(()=>import("./web-br6GjorP.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])).then(f=>new f.SignInWithAppleWeb)});function de(){const[f,b]=o.useState(!1);return{signInWithApple:async()=>{if(!$())return{success:!1,error:"Apple Sign In is only available on iOS devices"};if(!M)return{success:!1,error:"Authentication service not available"};b(!0);try{console.log("Starting native Apple Sign In...");const s=await z.authorize({requestedScopes:["email","fullName"]});if(console.log("Apple Sign In response:",s),!s.response.identityToken)throw new Error("No identity token received from Apple");const i=s.response.fullName;let m="";if(i){const h=i.givenName||"",x=i.familyName||"";m=`${h} ${x}`.trim(),console.log("Extracted name from Apple Sign In:",m)}console.log("Signing in to Supabase with Apple ID token...");let p,v=0;const r=3;for(;v<r;){v++,console.log(`Supabase sign-in attempt ${v}/${r}`);try{const h=new Promise((I,y)=>setTimeout(()=>y(new Error("Request timeout")),15e3)),x=M.auth.signInWithIdToken({provider:"apple",token:s.response.identityToken,nonce:s.response.nonce,options:{skipBrowserRedirect:!0,data:m?{name:m,given_name:i?.givenName,family_name:i?.familyName}:void 0}});p=await Promise.race([x,h]);break}catch(h){if(console.log(`Attempt ${v} failed:`,h),v===r)throw h;await new Promise(x=>setTimeout(x,1e3*v))}}return p?.error?(console.error("Supabase Apple Sign In error:",p.error),{success:!1,error:`Authentication failed: ${p.error.message}`}):(console.log("Apple Sign In successful:",p.data),{success:!0})}catch(s){return console.error("Native Apple Sign In failed:",s),s.message?.includes("canceled")||s.code===1001?{success:!1,error:"Sign in was canceled"}:s.code===1e3?{success:!1,error:'Apple Sign In not configured. Please enable "Sign In with Apple" capability in Xcode and ensure your Apple Developer account has this feature enabled.'}:s.code===1004?{success:!1,error:"Apple Sign In is not supported on this device or iOS version"}:s.name==="AuthRetryableFetchError"||s.message?.includes("AuthRetryableFetchError")||s.status===0?{success:!1,error:"Network connection issue. Please check your internet connection and try again."}:s.message?.includes("timeout")||s.message?.includes("Request timeout")?{success:!1,error:"Sign in timed out. Please try again."}:{success:!1,error:s.message||`Apple Sign In failed (Error ${s.code||"Unknown"})`}}finally{b(!1)}},checkAppleSignInAvailability:async()=>{if(!$())return!1;try{const s=await z.isAvailable();return console.log("Apple Sign In availability:",s),s.isAvailable}catch(s){return console.warn("Could not check Apple Sign In availability:",s),!1}},loading:f}}const Se=()=>{const f=K(),[b]=Y(),{user:w,loading:N,signInWithGoogle:s,signInWithApple:i,signInWithEmail:m,signUpWithEmail:p,startTrial:v}=Z(),[r,h]=o.useState(b.get("mode")!=="signup"),[x,I]=o.useState(""),[y,j]=o.useState(""),[c,l]=o.useState(""),[S,C]=o.useState(!1),[k,g]=o.useState(""),[D,R]=o.useState(!1);ae({onSwipeRight:()=>f("/"),threshold:100});const t=ee(),a=se(),{signInWithApple:d,loading:E}=de();if(o.useEffect(()=>{!N&&w&&(console.log("Authenticated user detected on login page, redirecting to dashboard"),f("/dashboard",{replace:!0})),te()},[w,N,f]),o.useEffect(()=>{const n=u=>{u.filename&&u.filename.includes("injected.js")&&(console.warn("Browser extension error detected - this is harmless and does not affect app functionality"),u.preventDefault())};return window.addEventListener("error",n),()=>window.removeEventListener("error",n)},[]),N)return e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-background",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 h-8 w-8 animate-spin rounded-full border-2 border-primary border-t-transparent"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading..."})]})});if(w)return null;const O=async n=>{n.preventDefault(),C(!0),g(""),console.log("Starting email auth flow...");try{let u;r?(console.log("Attempting sign in..."),u=await m(x,y),console.log("Sign in result:",u)):(console.log("Attempting sign up..."),u=await p(x,y,c),console.log("Sign up result:",u)),u.error?(console.error("Auth error:",u.error),u.error.name==="UserExistsError"&&!r?(g("An account with this email already exists."),h(!0),setTimeout(()=>{g("Please sign in with your existing account.")},2e3)):u.error.name==="EmailConfirmationRequired"?g("Account created! Please check your email and click the confirmation link to complete your registration."):g(u.error.message)):(console.log("Auth successful, proceeding..."),r||(console.log("Starting trial..."),await v()),console.log("Auth successful - navigation will be handled by auth state change"))}catch(u){console.error("Unexpected error in auth flow:",u),u instanceof Error?g(u.message):g("An unexpected error occurred during authentication")}finally{console.log("Auth flow completed, setting loading to false"),C(!1)}},U=async()=>{C(!0),g("");try{console.log("Starting Google Sign In");const{error:n}=await s();n&&(console.error("Google Sign In error:",n),g(n.message||"Google Sign In failed"))}catch(n){console.error("Google Sign In error:",n),g("Google Sign In failed. Please try again.")}finally{C(!1)}},H=async()=>{C(!0),g("");try{if($()){console.log("Using native Apple Sign In on iOS");const n=await d();n.success||g(n.error||"Apple Sign In failed")}else{console.log("Using web Apple Sign In");const{error:n}=await i();n&&g(n.message)}}catch(n){console.error("Apple Sign In error:",n),g("Failed to sign in with Apple")}finally{C(!1)}};return D?e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-background p-6 text-foreground",children:e.jsx(ce,{onBack:()=>R(!1),onSuccess:()=>{console.log("SMS login successful, navigating to dashboard"),f("/dashboard")}})}):e.jsxs("div",{className:"flex min-h-screen flex-col bg-background text-foreground",children:[e.jsx("div",{className:"flex items-center justify-between p-6",children:e.jsx(A,{variant:"ghost",onClick:()=>f("/"),className:"text-muted-foreground hover:text-foreground",children:"← Back"})}),e.jsx("div",{className:"flex flex-1 flex-col items-center justify-center px-6",children:e.jsxs("div",{className:"mb-12 text-center",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"font-inter text-4xl font-bold tracking-tight",children:"LogYourBody"}),e.jsx("p",{className:"mt-3 text-lg font-medium text-muted-foreground",children:"Track your body composition with precision"})]}),e.jsxs("div",{className:"mx-auto w-full max-w-sm space-y-4",children:[k&&e.jsx("div",{className:`rounded-md p-3 text-center text-sm ${k.includes("Account created!")||k.includes("Please sign in with your existing account")?"border border-blue-200 bg-blue-50 text-blue-700":"bg-destructive/10 text-destructive"}`,children:k}),t&&e.jsxs("form",{onSubmit:O,className:"space-y-4",children:[!r&&e.jsxs("div",{children:[e.jsx(L,{htmlFor:"name",className:"sr-only",children:"Name"}),e.jsx(P,{id:"name",type:"text",placeholder:"Full name",value:c,onChange:n=>l(n.target.value),required:!0,className:"h-12 border-border bg-secondary text-base text-foreground placeholder:text-muted-foreground"})]}),e.jsxs("div",{children:[e.jsx(L,{htmlFor:"email",className:"sr-only",children:"Email"}),e.jsx(P,{id:"email",type:"email",placeholder:"Email address",value:x,onChange:n=>I(n.target.value),required:!0,className:"h-12 border-border bg-secondary text-base text-foreground placeholder:text-muted-foreground"})]}),e.jsxs("div",{children:[e.jsx(L,{htmlFor:"password",className:"sr-only",children:"Password"}),e.jsx(P,{id:"password",type:"password",placeholder:"Password",value:y,onChange:n=>j(n.target.value),required:!0,className:"h-12 border-border bg-secondary text-base text-foreground placeholder:text-muted-foreground"})]}),e.jsx(A,{type:"submit",disabled:S,className:"font-inter h-12 w-full bg-primary text-base font-semibold text-primary-foreground hover:bg-primary/90",children:S?"Please wait...":r?"Sign In":"Create Account"})]}),(t||a)&&e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("span",{className:"w-full border-t border-border"})}),e.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:e.jsx("span",{className:"bg-background px-2 text-muted-foreground",children:"Or continue with"})})]}),e.jsxs("div",{className:"space-y-3",children:[!1,a&&e.jsxs(A,{type:"button",variant:"outline",onClick:U,disabled:S,className:"h-12 w-full border-border bg-secondary font-medium text-foreground hover:bg-muted",children:[e.jsxs("svg",{className:"mr-3 h-5 w-5",fill:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z",fill:"#4285F4"}),e.jsx("path",{d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z",fill:"#34A853"}),e.jsx("path",{d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z",fill:"#FBBC05"}),e.jsx("path",{d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z",fill:"#EA4335"})]}),S?"Signing in...":"Continue with Google"]}),e.jsxs(A,{type:"button",variant:"outline",onClick:H,disabled:S||E,className:"h-12 w-full border-border bg-secondary font-medium text-foreground hover:bg-muted",children:[e.jsx("svg",{className:"mr-3 h-5 w-5",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12.152 6.896c-.948 0-2.415-1.078-3.96-1.04-2.04.027-3.91 1.183-4.961 3.014-2.117 3.675-.546 9.103 1.519 12.09 1.013 1.454 2.208 3.09 3.792 3.039 1.52-.065 2.09-.987 3.935-.987 1.831 0 2.35.987 3.96.948 1.637-.026 2.676-1.48 3.676-2.948 1.156-1.688 1.636-3.325 1.662-3.415-.039-.013-3.182-1.221-3.22-4.857-.026-3.04 2.48-4.494 2.597-4.559-1.429-2.09-3.623-2.324-4.39-2.376-2-.156-3.675 1.09-4.61 1.09zM15.53 3.83c.843-1.012 1.4-2.427 1.245-3.83-1.207.052-2.662.805-3.532 1.818-.78.896-1.454 2.338-1.273 3.714 1.338.104 2.715-.688 3.559-1.701"})}),S||E?"Signing in...":"Continue with Apple"]})]}),t&&e.jsx("div",{className:"text-center",children:e.jsx(A,{type:"button",variant:"ghost",onClick:()=>h(!r),className:"text-sm text-muted-foreground hover:text-foreground",children:r?"Don't have an account? Sign up":"Already have an account? Sign in"})})]})]})}),e.jsxs("div",{className:"p-6 text-center",children:[e.jsxs("p",{className:"text-sm font-medium text-muted-foreground",children:["By continuing, you agree to our"," ",e.jsx("button",{onClick:()=>f("/terms"),className:"text-primary hover:underline",children:"Terms of Service"})," ","and"," ",e.jsx("button",{onClick:()=>f("/privacy"),className:"text-primary hover:underline",children:"Privacy Policy"})]}),e.jsx("div",{className:"mt-4 flex justify-center gap-4",children:e.jsx("button",{onClick:()=>f("/changelog"),className:"text-sm text-muted-foreground transition-colors hover:text-foreground",children:"Changelog"})}),e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsx(ie,{})})]})]})};export{Se as default};
