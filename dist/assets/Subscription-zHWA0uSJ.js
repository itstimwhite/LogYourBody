import{j as e}from"./ui-vendor-BTNJdHiL.js";import{a as l,u as R}from"./react-vendor-CGPzL8fz.js";import{B as m,c as S,a as j}from"./index-BWixOZri.js";import{R as I}from"./RevenueCatPaywall-DGfoo2xU.js";import{X as P,l as k,g as E,m as B,n as L,e as U,W as y,b as T,O as M,N as z}from"./utils-vendor-BD55slVq.js";import{m as v}from"./radio-group-BXTCuRDb.js";import{u as F}from"./use-swipe-navigation-Br04oNeb.js";import{p as C}from"./prefetch-BKo02pYs.js";import"./data-vendor-Dz4nk24n.js";import"./analytics-vendor-CXgENQ1a.js";import"./switch-CXlYUX7z.js";import"./focus-management-6kc7Qb5h.js";import"./bugs-2q_Jw5H1.js";const $={status:"trial",trialStartDate:new Date(Date.now()-24*60*60*1e3),trialEndDate:new Date(Date.now()+2*24*60*60*1e3),isTrialActive:!0,daysRemainingInTrial:2},H={nextBillingDate:new Date(Date.now()+2*24*60*60*1e3),paymentMethod:"Apple Pay",amount:9.99,currency:"USD"};function D(){const[r,i]=l.useState($),[c,x]=l.useState(H),[h,o]=l.useState(!1),n=l.useCallback(()=>{if(!r.trialStartDate||!r.trialEndDate)return{isTrialActive:!1,daysRemainingInTrial:0};const t=new Date,s=r.trialEndDate,a=t<s,f=Math.max(0,Math.ceil((s.getTime()-t.getTime())/(1e3*60*60*24)));return{isTrialActive:a,daysRemainingInTrial:f}},[r.trialStartDate,r.trialEndDate]),u=l.useMemo(()=>{const{isTrialActive:t}=n();return r.status==="active"||t},[r.status,n]),g=l.useMemo(()=>{const{isTrialActive:t}=n();return r.status==="trial"&&!t},[r.status,n]),d=l.useCallback(async()=>{o(!0);try{console.log("Initializing RevenueCat..."),await new Promise(a=>setTimeout(a,1e3));const{isTrialActive:t,daysRemainingInTrial:s}=n();i(a=>({...a,isTrialActive:t,daysRemainingInTrial:s}))}catch(t){console.error("Failed to initialize RevenueCat:",t)}finally{o(!1)}},[n]),p=l.useCallback(async()=>{o(!0);try{const t=new Date,s=new Date(t.getTime()+3*24*60*60*1e3);i({status:"trial",trialStartDate:t,trialEndDate:s,isTrialActive:!0,daysRemainingInTrial:3}),console.log("Trial started")}catch(t){console.error("Failed to start trial:",t)}finally{o(!1)}},[]),b=l.useCallback(async t=>{o(!0);try{console.log("Purchasing subscription:",t),await new Promise(f=>setTimeout(f,2e3));const s=new Date,a=new Date(s.getTime()+30*24*60*60*1e3);return i({status:"active",subscriptionStartDate:s,subscriptionEndDate:a,productId:t,isTrialActive:!1,daysRemainingInTrial:0}),x({nextBillingDate:a,lastPaymentDate:s,paymentMethod:"Apple Pay",amount:t.includes("yearly")?79.99:9.99,currency:"USD"}),{success:!0}}catch(s){return console.error("Purchase failed:",s),{success:!1,error:s}}finally{o(!1)}},[]),N=l.useCallback(async()=>{o(!0);try{return console.log("Restoring purchases..."),await new Promise(t=>setTimeout(t,1e3)),{success:!0}}catch(t){return console.error("Restore failed:",t),{success:!1,error:t}}finally{o(!1)}},[]),w=l.useCallback(async()=>{const s=/iPad|iPhone|iPod/.test(navigator.userAgent)?"https://apps.apple.com/account/subscriptions":"https://play.google.com/store/account/subscriptions";window.open(s,"_blank")},[]);return l.useEffect(()=>{d()},[d]),l.useEffect(()=>{const t=setInterval(()=>{const{isTrialActive:s,daysRemainingInTrial:a}=n();i(f=>({...f,isTrialActive:s,daysRemainingInTrial:a}))},6e4);return()=>clearInterval(t)},[n]),{subscriptionInfo:r,billingInfo:c,isLoading:h,hasAccess:u,isTrialExpired:g,startTrial:p,purchaseSubscription:b,restorePurchases:N,cancelSubscription:w,initializeRevenueCat:d}}const A=[{id:"monthly",name:"Monthly",price:"$9.99",period:"monthly",features:["Unlimited body measurements","Advanced analytics & trends","Photo progress tracking","Health app sync","Export data","Priority support"],revenueCatProductId:"logyourbody_monthly"},{id:"yearly",name:"Annual",price:"$69.99",period:"yearly",features:["Unlimited body measurements","Advanced analytics & trends","Photo progress tracking","Health app sync","Export data","Priority support","Save 42% vs monthly"],isPopular:!0,revenueCatProductId:"logyourbody_yearly"}];function O({onClose:r,title:i="Access Paused",subtitle:c="Continue tracking your body composition with LogYourBody Premium",showCloseButton:x=!1}){const{purchaseSubscription:h,isLoading:o,subscriptionInfo:n}=D(),[u,g]=l.useState(A[1].id),[d,p]=l.useState(!0),b=()=>{r?.()},N=s=>{console.error("RevenueCat error:",s),p(!1)},w=async()=>{const s=A.find(a=>a.id===u);s&&(await h(s.revenueCatProductId)).success&&r&&r()},t=[{icon:k,title:"Advanced Analytics",subtitle:"& Trends"},{icon:E,title:"Progress Tracking",subtitle:"& Insights"},{icon:B,title:"Photo Progress",subtitle:"Tracking"},{icon:L,title:"Health App",subtitle:"Sync"}];return d?e.jsxs("div",{className:"fixed inset-0 z-50 flex flex-col bg-background",children:[e.jsxs("div",{className:"flex items-center justify-between p-6",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"LogYourBody"}),x&&r&&e.jsx(m,{size:"icon",variant:"ghost",onClick:r,className:"h-8 w-8 text-muted-foreground hover:text-foreground",children:e.jsx(P,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6",children:e.jsxs("div",{className:"mx-auto max-w-md space-y-8",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h1",{className:"text-4xl font-light text-foreground",children:i.split(" ")[0]||"ACCESS"}),e.jsx("h2",{className:"text-4xl font-bold text-primary",children:i.split(" ")[1]||"PAUSED"}),e.jsx("p",{className:"text-lg text-muted-foreground",children:c}),n.isTrialActive&&e.jsxs("div",{className:"text-sm font-medium text-primary",children:[n.daysRemainingInTrial," days left in trial"]})]}),e.jsx(I,{onSuccess:b,onError:N}),e.jsx("div",{className:"flex justify-center",children:e.jsx(m,{variant:"ghost",onClick:()=>window.open("mailto:support@logyourbody.com?subject=LogYourBody Support Request","_blank"),className:"text-muted-foreground hover:text-foreground",children:"Need Help?"})})]})})]}):e.jsxs("div",{className:"fixed inset-0 z-50 flex flex-col bg-background",children:[e.jsxs("div",{className:"flex items-center justify-between p-6",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"LogYourBody"}),x&&r&&e.jsx(m,{size:"icon",variant:"ghost",onClick:r,className:"h-8 w-8 text-muted-foreground hover:text-foreground",children:e.jsx(P,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6",children:e.jsxs("div",{className:"mx-auto max-w-md space-y-8",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h1",{className:"text-4xl font-light text-foreground",children:"ACCESS"}),e.jsx("h2",{className:"text-4xl font-bold text-primary",children:"PAUSED"}),e.jsx("p",{className:"text-lg text-muted-foreground",children:c}),n.isTrialActive&&e.jsxs("div",{className:"text-sm font-medium text-primary",children:[n.daysRemainingInTrial," days left in trial"]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:t.map((s,a)=>e.jsxs("div",{className:"rounded-lg border border-border bg-secondary/30 p-4",children:[e.jsx(s.icon,{className:"mb-3 h-8 w-8 text-primary"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm font-semibold text-foreground",children:s.title}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.subtitle})]})]},a))}),e.jsxs(v,{value:u,onChange:g,children:[e.jsx(v.Label,{className:"sr-only",children:"Choose subscription plan"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(v.Option,{value:"yearly",children:({checked:s,active:a})=>e.jsxs("div",{className:S("relative cursor-pointer rounded-lg border-2 p-4 transition-all",s?"border-primary bg-primary/5":"border-border bg-secondary/30",a&&"ring-2 ring-primary/50"),children:[s&&e.jsx(j,{className:"absolute -top-2 right-4 bg-primary text-xs text-primary-foreground",children:"Save 42% with Annual"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xl font-semibold text-foreground",children:"Annual"}),e.jsx("div",{className:"text-muted-foreground",children:"$69.99 billed yearly"})]}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:"text-xl font-bold text-foreground",children:"$5.83/mo"})})]})]})}),e.jsx(v.Option,{value:"monthly",children:({checked:s,active:a})=>e.jsx("div",{className:S("relative cursor-pointer rounded-lg border-2 p-4 transition-all",s?"border-primary bg-primary/5":"border-border bg-secondary/30",a&&"ring-2 ring-primary/50"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xl font-semibold text-foreground",children:"Monthly"}),e.jsx("div",{className:"text-muted-foreground",children:"$9.99 billed monthly"})]}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:"text-xl font-bold text-foreground",children:"$9.99/mo"})})]})})})]})]})]})}),e.jsxs("div",{className:"space-y-4 p-6",children:[e.jsx(m,{onClick:w,disabled:o,className:"h-14 w-full rounded-xl bg-primary text-lg font-semibold text-primary-foreground hover:bg-primary/90",children:o?"Processing...":"Resume Now"}),e.jsx("div",{className:"flex justify-center",children:e.jsx(m,{variant:"ghost",onClick:()=>window.open("mailto:support@logyourbody.com?subject=LogYourBody Support Request","_blank"),disabled:o,className:"text-muted-foreground hover:text-foreground",children:"Need Help?"})}),e.jsx("p",{className:"text-center text-xs leading-relaxed text-muted-foreground",children:"Subscription automatically renews unless cancelled. Cancel anytime in your account settings. By subscribing you agree to our Terms of Service and Privacy Policy."})]})]})}const te=()=>{const r=R(),{subscriptionInfo:i,billingInfo:c,cancelSubscription:x,isLoading:h}=D(),[o,n]=l.useState(!1);F({onSwipeRight:()=>r("/settings"),threshold:100});const u=d=>d?d.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"N/A",g=()=>{switch(i.status){case"trial":return e.jsx(j,{variant:"outline",className:"border-primary text-primary",children:"Trial Active"});case"active":return e.jsx(j,{className:"bg-green-500 text-white",children:"Active"});case"expired":case"cancelled":return e.jsx(j,{variant:"destructive",children:"Expired"});default:return null}};return o?e.jsx(O,{onClose:()=>n(!1),showCloseButton:!0}):e.jsxs("div",{className:"min-h-svh bg-background text-foreground",children:[e.jsxs("div",{className:"flex items-center gap-4 border-b border-border px-6 py-4",children:[e.jsx(m,{size:"icon",variant:"outline",onMouseEnter:()=>C("/settings"),onFocus:()=>C("/settings"),onClick:()=>r("/settings"),className:"h-10 w-10 border-border bg-secondary text-foreground hover:bg-muted",children:e.jsx(U,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{className:"h-5 w-5 text-primary"}),e.jsx("h1",{className:"text-xl font-semibold tracking-tight",children:"Subscription"})]})]}),e.jsxs("div",{className:"space-y-8 p-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Current Plan"}),g()]}),e.jsx("div",{className:"space-y-4 rounded-lg bg-secondary/30 p-6",children:i.status==="trial"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-primary/10",children:e.jsx(y,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-foreground",children:"Free Trial"}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[i.daysRemainingInTrial," days remaining"]})]})]}),i.trialEndDate&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(T,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{className:"text-muted-foreground",children:["Trial ends on ",u(i.trialEndDate)]})]}),e.jsx(m,{onClick:()=>n(!0),className:"w-full bg-primary text-primary-foreground hover:bg-primary/90",children:"Upgrade to Premium"})]}):i.status==="active"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-green-500/10",children:e.jsx(y,{className:"h-6 w-6 text-green-500"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-foreground",children:"Premium"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Active subscription"})]})]}),i.subscriptionEndDate&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(T,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{className:"text-muted-foreground",children:["Renews on"," ",u(i.subscriptionEndDate)]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-destructive/10",children:e.jsx(M,{className:"h-6 w-6 text-destructive"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-foreground",children:"Subscription Expired"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Reactivate to continue using LogYourBody"})]})]}),e.jsx(m,{onClick:()=>n(!0),className:"w-full bg-primary text-primary-foreground hover:bg-primary/90",children:"Reactivate Premium"})]})})]}),i.status==="active"&&c&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Billing Information"}),e.jsxs("div",{className:"space-y-4 rounded-lg bg-secondary/30 p-6",children:[c.nextBillingDate&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Next billing date"}),e.jsx("span",{className:"font-medium text-foreground",children:u(c.nextBillingDate)})]}),c.amount&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Amount"}),e.jsxs("span",{className:"font-medium text-foreground",children:["$",c.amount," ",c.currency]})]}),c.paymentMethod&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Payment method"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium text-foreground",children:c.paymentMethod})]})]})]})]}),i.status==="active"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Manage Subscription"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(m,{variant:"outline",onClick:x,disabled:h,className:"w-full",children:"Manage in App Store"}),e.jsx("p",{className:"text-center text-xs text-muted-foreground",children:"To cancel or modify your subscription, use your device's App Store or Google Play settings."})]})]}),i.status!=="active"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Premium Features"}),e.jsx("div",{className:"space-y-3 rounded-lg bg-secondary/30 p-6",children:["Unlimited body measurements","Advanced analytics & trends","Photo progress tracking","Health app sync","Export data","Priority support"].map((d,p)=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(y,{className:"h-4 w-4 flex-shrink-0 text-primary"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:d})]},p))})]})]})]})};export{te as default};
