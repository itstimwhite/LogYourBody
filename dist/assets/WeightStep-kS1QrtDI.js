import{j as e}from"./ui-vendor-BTNJdHiL.js";import{a as p}from"./react-vendor-CGPzL8fz.js";import{m as s,c as m,h as q,o as M,j as z,A as C,x as j,H as N,I as P}from"./index-BWixOZri.js";import{u as G,w as g,a as I}from"./Dashboard-jXZD-6ec.js";import{w as O,a as k}from"./weight-logging-rZoVubPW.js";import{S as Q,L as B,d as J}from"./utils-vendor-BD55slVq.js";import"./data-vendor-Dz4nk24n.js";import"./analytics-vendor-CXgENQ1a.js";import"./use-is-mounted-Dtnm4exq.js";import"./focus-management-6kc7Qb5h.js";import"./input-CkE6ZwYN.js";import"./label-DJ6QZZke.js";import"./progress-DaDOMKAa.js";import"./VersionDisplay-BrEkyV1W.js";import"./prefetch-BKo02pYs.js";import"./use-supabase-body-metrics-D-84L7_Y.js";import"./use-swipe-navigation-Br04oNeb.js";function X({children:c,className:d}){return e.jsx(s.div,{className:m("space-y-8",d),initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.25,type:"spring",damping:20},children:c})}function Y({icon:c,title:d,subtitle:l,iconBgColor:r="bg-linear-purple/10",iconColor:h="text-linear-purple"}){return e.jsxs("div",{className:"space-y-4 text-center",children:[e.jsx(s.div,{className:m("mx-auto flex h-20 w-20 items-center justify-center rounded-3xl",r),whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsx("div",{className:m("h-10 w-10",h),children:c})}),e.jsxs("div",{children:[e.jsx("h1",{className:"mb-2 text-3xl font-bold text-linear-text",children:d}),l&&e.jsx("p",{className:"text-lg text-linear-text-secondary",children:l})]})]})}function ge({value:c,onChange:d}){const{setCanGoNext:l}=G(),[r,h]=p.useState(c.value>0?c.value.toString():""),[i,V]=p.useState(c.unit),[K,$]=p.useState(!1),[b,S]=p.useState(!1),H=p.useRef(null),v=q.isNativePlatform(),y=M(),D=z()&&(y.loading?!0:y.isAvailable);p.useEffect(()=>{const t=setTimeout(()=>{H.current?.focus(),g.startStep(1)},300);return()=>clearTimeout(t)},[]),p.useEffect(()=>{const t=parseFloat(r);if(isNaN(t)||r===""){l(!1);return}const a={value:t,unit:i};try{O.parse(a),d(a),l(!0)}catch{l(!1)}},[r,i,d,l]);const A=t=>{S(!0);const a=t.replace(/[^0-9.]/g,""),n=a.split(".");let u;n.length>2?u=`${n[0]}.${n.slice(1).join("")}`:u=a;const[f,w]=u.split(".");let x;if(w===void 0?x=f:w===""?x=`${f}.`:n.length>2?x=`${f}.${w.slice(0,2)}`:x=`${f}.${w.slice(0,1)}`,h(x),b){const R=I.getPrecision(parseFloat(x)||0);g.trackWeightInput({method:"manual_typing",unit_toggle_used:!1,precision_decimals:R})}},F=async()=>{v&&await N.impact({style:P.Light});const t={value:parseFloat(r)||0,unit:i},a=i==="lbs"?"kg":"lbs",n=k.convertWeight(t,a);V(a),h(n.value.toFixed(1)),g.trackWeightInput({method:"manual_typing",unit_toggle_used:!0,precision_decimals:I.getPrecision(n.value)})},T=async t=>{v&&await N.impact({style:P.Light}),h(t.toString()),S(!0),g.trackWeightInput({method:"preset_chip",unit_toggle_used:!1,precision_decimals:0})},E=async()=>{if(D){$(!0);try{if(!y.isAuthorized&&!await y.requestPermissions()){j({title:"HealthKit Access Required",description:"Please grant access to import your weight data",variant:"destructive"});return}const t=await y.getHealthData();if(t&&t.weight){const a={value:t.weight,unit:"kg"},n=k.convertWeight(a,i),u=Math.round(n.value*10)/10;h(u.toString()),S(!0),d({value:u,unit:i}),l(!0),g.trackWeightInput({method:"healthkit_import",unit_toggle_used:!1,precision_decimals:I.getPrecision(n.value)}),v&&await N.notification({type:"success"}),j({title:"Weight Imported",description:`${u} ${i} from HealthKit`})}else j({title:"No Weight Data",description:"No recent weight data found in HealthKit",variant:"destructive"})}catch(t){console.error("HealthKit import error:",t),j({title:"Import Failed",description:"Could not import weight from HealthKit",variant:"destructive"}),v&&await N.notification({type:"error"})}finally{$(!1)}}},U=t=>{if(t.key==="Enter"||t.key==="Done"){t.preventDefault(),H.current?.blur();const a=parseFloat(r)||0;a>=30&&a<=700&&g.completeStep({step_number:1,step_name:"weight",interaction_type:"keyboard",value:`${a} ${i}`})}},L=k.getWeightPresets(i),o=parseFloat(r)||0,W=o>0?k.getWeightHelper({value:o,unit:i}):"",_=o>=30&&o<=700;return e.jsxs(X,{children:[e.jsx(Y,{icon:e.jsx(Q,{}),title:"What's your weight?",subtitle:"Enter your current weight measurement"}),D&&e.jsx(s.button,{onClick:E,disabled:K,className:"flex h-14 w-full items-center justify-center gap-3 rounded-xl border border-linear-border bg-linear-card transition-colors hover:bg-linear-border/50 disabled:opacity-50",whileTap:{scale:.98},initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.1,duration:.25},children:K?e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"h-5 w-5 animate-spin text-linear-purple"}),e.jsx("span",{className:"font-medium text-linear-text",children:"Importing from HealthKit..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"h-5 w-5 text-linear-purple"}),e.jsx("span",{className:"font-medium text-linear-text",children:"Import from HealthKit"})]})}),e.jsx(s.div,{className:"flex justify-center",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2,duration:.25},children:e.jsxs("div",{className:"flex rounded-xl bg-linear-card border border-linear-border p-1",children:[e.jsx("button",{onClick:F,className:m("rounded-lg px-6 py-3 font-medium transition-all duration-200",i==="lbs"?"bg-linear-purple text-white shadow-sm":"text-linear-text-secondary hover:text-linear-text"),children:"lbs"}),e.jsx("button",{onClick:F,className:m("rounded-lg px-6 py-3 font-medium transition-all duration-200",i==="kg"?"bg-linear-purple text-white shadow-sm":"text-linear-text-secondary hover:text-linear-text"),children:"kg"})]})}),e.jsxs(s.div,{className:"space-y-3",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3,duration:.25},children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{ref:H,type:"text",inputMode:"decimal",pattern:"[0-9]+([.,][0-9]{1})?",value:r,onChange:t=>A(t.target.value),onKeyDown:U,placeholder:i==="lbs"?"150.0":"68.0",className:m("h-16 w-full px-6 text-center text-3xl font-bold","rounded-xl border border-linear-border bg-linear-card","text-linear-text placeholder:text-linear-text-tertiary/50","transition-all duration-200","focus:border-linear-purple focus:bg-linear-card focus:outline-none",!_&&b&&o>0&&"border-red-500 focus:border-red-500 focus:ring-red-500/20"),"aria-label":`Weight in ${i}`,"aria-invalid":!_&&b&&o>0}),e.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 transform text-xl font-medium text-linear-text-secondary",children:i})]}),e.jsx(C,{mode:"wait",children:W&&e.jsx(s.p,{className:"text-center text-lg text-linear-text-secondary",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},transition:{duration:.2},children:W},W)}),e.jsx(C,{mode:"wait",children:!_&&b&&o>0&&e.jsx(s.p,{className:"text-center text-red-500",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},transition:{duration:.2},role:"alert",children:o<30?"Weight must be at least 30 lbs (13.6 kg)":"Weight must be less than 700 lbs (317.5 kg)"})})]}),e.jsxs(s.div,{className:"space-y-3",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.4,duration:.25},children:[e.jsx("p",{className:"text-center text-sm font-medium text-linear-text-tertiary",children:"Quick presets"}),e.jsx("div",{className:"scrollbar-hide flex gap-2 overflow-x-auto pb-2",children:L.map(t=>e.jsxs(s.button,{onClick:()=>T(t),className:m("flex-shrink-0 rounded-xl border px-4 py-3 font-medium transition-all duration-200",parseFloat(r)===t?"border-linear-purple bg-linear-purple text-white":"border-linear-border bg-linear-card text-linear-text hover:bg-linear-border/50"),whileTap:{scale:.95},children:[t," ",i]},t))})]})]})}export{ge as WeightStep};
